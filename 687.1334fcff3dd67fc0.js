"use strict";(self.webpackChunkapp_viagens=self.webpackChunkapp_viagens||[]).push([[687],{687:(Qe,F,l)=>{l.r(F),l.d(F,{ReportsModule:()=>Ve});var T=l(6895),p=l(4006),h=l(3546),y=l(9549),Z=l(4144),A=l(4385),N=l(4859),w=l(7392),M=l(9602),E=l(3238),f=l(7155),U=l(1572),q=l(7009),O=l(3848),P=l(7957),x=l(7084),J=l(144),b=l(9646),S=l(8675),_=l(4004),L=l(8372),V=l(1884),Q=l(3900),Y=l(262),$=l(8746);const H={air_ticket:"Passagem A\xe9rea",bus_ticket:"Passagem Rodovi\xe1ria",train_ticket:"Passagem Ferrovi\xe1ria",hotel:"Hotel",car_rental:"Aluguel de Ve\xedculo",travel_insurance:"Seguro Viagem",travel_package:"Pacote de Viagem",transfer:"Transfer",seat:"Assento",extra_baggage:"Bagagem Extra",rebooking:"Remarca\xe7\xe3o"};function u(r){if(null==r)return"";const s=String(r).trim();return s?H[s]??s:""}const X=[{key:"performance",label:"Desempenho",code:"A",description:"Indicadores e visoes de vendas para acompanhar resultados e produtividade."},{key:"utilization",label:"Utilizacao",code:"B",description:"Eventos operacionais por periodo e produto, mostrando o uso real dos servicos."},{key:"financial",label:"Financeiro",code:"C",description:"Movimentacoes financeiras e fluxo de caixa com contas a pagar/receber."}],z=[{value:"air_ticket",label:u("air_ticket")},{value:"car_rental",label:u("car_rental")},{value:"hotel",label:u("hotel")},{value:"travel_package",label:u("travel_package")},{value:"travel_insurance",label:u("travel_insurance")},{value:"rebooking",label:u("rebooking")},{value:"extra_baggage",label:u("extra_baggage")},{value:"seat",label:u("seat")},{value:"bus_ticket",label:u("bus_ticket")},{value:"train_ticket",label:u("train_ticket")},{value:"transfer",label:u("transfer")}],G={customer:!0,seller:!1,productType:!1,passenger:!1,os:!1,status:!1,dateTravel:!1,dateSale:!0};function D(r){return{...G,...r?.supportedFilters??{}}}function R(r){return Boolean(r?.supportsReportMode)}const ee=[{key:"sales",label:"Vendas",description:"Relatorio detalhado de vendas com clientes e vendedores.",category:"performance",requiresDate:!1,supportsReportMode:!0,defaultDateMode:"sale",supportedFilters:{customer:!0,seller:!0,productType:!0,passenger:!0,os:!0,status:!1,dateTravel:!0,dateSale:!0},previewColumns:[{key:"customerName",label:"Cliente"},{key:"productType",label:"Produto/Servico"},{key:"sellDate",label:"Data da emissao"},{key:"paymentMethod",label:"Metodo de pagamento"},{key:"costValue",label:"Custo"},{key:"totalValue",label:"Valor total pago"}]},{key:"sales-by-seller",label:"Vendas por Vendedor",description:"Resumo por vendedor com volume e ticket medio.",category:"performance",requiresDate:!0,supportsReportMode:!1,defaultDateMode:"sale",supportedFilters:{customer:!0,seller:!0,productType:!1,passenger:!1,os:!1,status:!1,dateTravel:!1,dateSale:!0},previewColumns:[{key:"sellerName",label:"Vendedor"},{key:"totalSales",label:"Total vendas"},{key:"totalValue",label:"Valor total"},{key:"avgTicket",label:"Ticket medio"},{key:"totalCommission",label:"Comissao total"}]},{key:"utilization-events",label:"Utilizacao (Eventos)",description:"Eventos de uso por produto no periodo selecionado.",category:"utilization",requiresDate:!0,supportsReportMode:!0,defaultDateMode:"travel",supportedFilters:{customer:!0,seller:!1,productType:!0,passenger:!0,os:!0,status:!1,dateTravel:!0,dateSale:!0},previewColumns:[{key:"eventDateTime",label:"Data/Hora"},{key:"customerName",label:"Cliente"},{key:"passengerName",label:"Passageiro"},{key:"productType",label:"Produto/Servico"},{key:"origin",label:"Origem"},{key:"destination",label:"Destino"},{key:"saleDate",label:"Data da venda"},{key:"costValue",label:"Custo"},{key:"marginValue",label:"Margem"},{key:"totalValue",label:"Valor total pago"}]},{key:"trips",label:"Aereo (Trechos)",description:"Detalhamento de trechos aereos com datas e origens.",category:"utilization",requiresDate:!0,supportsReportMode:!1,defaultDateMode:"travel",supportedFilters:{customer:!0,seller:!1,productType:!1,passenger:!0,os:!0,status:!1,dateTravel:!0,dateSale:!0},previewColumns:[{key:"customerName",label:"Cliente"},{key:"ticketType",label:"Tipo de bilhete"},{key:"airline",label:"Companhia"},{key:"origin",label:"Aeroporto origem"},{key:"originCity",label:"Cidade origem"},{key:"departureDateTime",label:"Data/hora partida"},{key:"value",label:"Valor"},{key:"sellDate",label:"Data da venda"}]},{key:"accounts-payable",label:"Contas a Pagar",description:"Transacoes de despesas com status e datas de pagamento.",category:"financial",requiresDate:!1,supportsStatusFilter:!0,supportsReportMode:!1,defaultDateMode:"sale",supportedFilters:{customer:!0,seller:!1,productType:!1,passenger:!1,os:!1,status:!0,dateTravel:!1,dateSale:!0},previewColumns:[{key:"customerName",label:"Cliente"},{key:"amount",label:"Valor"},{key:"status",label:"Status"},{key:"paymentDate",label:"Data pagamento"}]},{key:"accounts-receivable",label:"Contas a Receber",description:"Transacoes de receitas com status e datas de recebimento.",category:"financial",requiresDate:!1,supportsStatusFilter:!0,supportsReportMode:!1,defaultDateMode:"sale",supportedFilters:{customer:!0,seller:!1,productType:!1,passenger:!1,os:!1,status:!0,dateTravel:!1,dateSale:!0},previewColumns:[{key:"customerName",label:"Cliente"},{key:"amount",label:"Valor"},{key:"status",label:"Status"},{key:"receivedDate",label:"Data recebimento"}]},{key:"cashflow-summary",label:"Fluxo de Caixa",description:"Resumo de entradas, saidas e saldo por periodo.",category:"financial",requiresDate:!0,supportsReportMode:!1,defaultDateMode:"sale",supportedFilters:{customer:!1,seller:!1,productType:!1,passenger:!1,os:!1,status:!1,dateTravel:!1,dateSale:!0},previewColumns:[{key:"period",label:"Periodo"},{key:"totalIncome",label:"Entradas"},{key:"totalExpense",label:"Saidas"},{key:"netValue",label:"Saldo"}]}];var m=l(1641),e=l(4650),B=l(529),I=l(2843),K=l(2340),te=l(8444);let ae=(()=>{class r{constructor(t,a){this.http=t,this.tenantService=a,this.apiUrl=`${K.N.backendV1Url}/reports`}toYmd(t){if(!t)return;if("string"==typeof t){const d=t.match(/^(\d{4}-\d{2}-\d{2})/);if(d)return d[1]}const a="string"==typeof t?new Date(t):t;return isNaN(a.getTime())?void 0:`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}-${String(a.getDate()).padStart(2,"0")}`}buildParams(t,a){let o=new B.LE;const n=this.toYmd(t.startDate),i=this.toYmd(t.endDate);n&&(o=o.set("start_date",n)),i&&(o=o.set("end_date",i));const d=this.toYmd(t.travelDateStart),c=this.toYmd(t.travelDateEnd);d&&(o=o.set("travel_date_start",d)),c&&(o=o.set("travel_date_end",c));const g=this.toYmd(t.saleDateStart),v=this.toYmd(t.saleDateEnd);g&&(o=o.set("sale_date_start",g)),v&&(o=o.set("sale_date_end",v)),t.statusFilter&&(o=o.set("status_filter",t.statusFilter)),null!=t.sellerId&&""!==String(t.sellerId)&&(o=o.set("seller_id",String(t.sellerId))),null!=t.customerId&&""!==String(t.customerId)&&(o=o.set("customer_id",String(t.customerId))),t.serviceOrderCode&&(o=o.set("service_order_code",String(t.serviceOrderCode))),t.passengerName&&(o=o.set("passenger_name",String(t.passengerName))),t.reportMode&&(o=o.set("report_mode",t.reportMode));const C=t.saleType,k=t.productType;if(k&&(o=o.set("product_type",k)),!k)if("utilization-events"===a){const j=C;j&&(o=o.set("product_type",j))}else C&&(o=o.set("category",C));return o}exportReportCsv(t,a){const o=this.tenantService.getCurrentTenantId();if(!o)return(0,I._)(()=>new Error("TenantId nao resolvido"));const n=this.buildParams(a,t);return this.http.get(`${this.apiUrl}/csv/${t}`,{params:n,responseType:"blob",headers:{"mtm-token":`Bearer ${localStorage.getItem("token")??""}`,"X-Tenant-Id":o}})}exportReportPdf(t,a){const o=this.tenantService.getCurrentTenantId();if(!o)return(0,I._)(()=>new Error("TenantId nao resolvido"));const n=this.buildParams(a,t);return this.http.get(`${this.apiUrl}/pdf/${t}`,{params:n,responseType:"blob",headers:{"mtm-token":`Bearer ${localStorage.getItem("token")??""}`,"X-Tenant-Id":o}})}exportSalesReport(t){return this.exportReportCsv("sales",t)}exportTripsReport(t){return this.exportReportCsv("trips",t)}exportAccountsPayableReport(t){return this.exportReportCsv("accounts-payable",t)}exportAccountsReceivableReport(t){return this.exportReportCsv("accounts-receivable",t)}downloadFile(t,a){const o=window.URL.createObjectURL(t),n=document.createElement("a");n.href=o,n.download=a,document.body.appendChild(n),n.click(),document.body.removeChild(n),window.URL.revokeObjectURL(o)}getReportPreview(t,a){const o=this.buildParams(a,t),n=this.tenantService.getCurrentTenantId();if(!n)return(0,I._)(()=>new Error("TenantId nao resolvido"));if(!K.N.production){const i=this.toYmd(a.startDate),d=this.toYmd(a.endDate);console.debug("[Reports] preview params",{start_date:i,end_date:d,travel_date_start:this.toYmd(a.travelDateStart),travel_date_end:this.toYmd(a.travelDateEnd),sale_date_start:this.toYmd(a.saleDateStart),sale_date_end:this.toYmd(a.saleDateEnd),seller_id:a.sellerId,category:"utilization-events"===t?void 0:a.saleType,product_type:"utilization-events"===t?a.productType||a.saleType:void 0,status_filter:a.statusFilter,customer_id:a.customerId,service_order_code:a.serviceOrderCode,passenger_name:a.passengerName,report_mode:a.reportMode,reportType:t})}return this.http.get(`${this.apiUrl}/preview/${t}`,{params:o,headers:{"mtm-token":`Bearer ${localStorage.getItem("token")??""}`,"X-Tenant-Id":n}}).pipe((0,_.U)(i=>({data:i.data??[],total:"number"==typeof i.total_count?i.total_count:i.total??(i.data?i.data.length:0)})))}}return r.\u0275fac=function(t){return new(t||r)(e.LFG(B.eN),e.LFG(te.a))},r.\u0275prov=e.Yz7({token:r,factory:r.\u0275fac,providedIn:"root"}),r})();var oe=l(4988),re=l(3987),ne=l(6821);function se(r,s){if(1&r&&e._UZ(0,"mat-tab",26),2&r){const t=s.$implicit;e.Q6J("label",t.code+") "+t.label)}}function ie(r,s){if(1&r&&(e.TgZ(0,"mat-option",27),e._uU(1),e.qZA()),2&r){const t=s.$implicit;e.Q6J("value",t.key),e.xp6(1),e.hij(" ",t.label," ")}}function le(r,s){if(1&r&&(e.TgZ(0,"mat-hint"),e._uU(1),e.qZA()),2&r){const t=e.oxw();e.xp6(1),e.Oqu(t.selectedReport.description)}}function de(r,s){if(1&r&&(e.TgZ(0,"mat-option",27),e._uU(1),e.qZA()),2&r){const t=s.$implicit;e.Q6J("value",t.value),e.xp6(1),e.hij(" ",t.label," ")}}function ce(r,s){if(1&r&&(e.TgZ(0,"mat-form-field",10)(1,"mat-label"),e._uU(2,"Tipo de relatorio"),e.qZA(),e.TgZ(3,"mat-select",28),e.YNc(4,de,2,2,"mat-option",12),e.qZA()()),2&r){const t=e.oxw();e.xp6(4),e.Q6J("ngForOf",t.reportModeOptions)}}function pe(r,s){if(1&r&&(e.TgZ(0,"mat-option",33),e._uU(1),e.qZA()),2&r){const t=s.$implicit,a=e.oxw(2);e.Q6J("value",t.value)("disabled","travel"===t.value&&!a.supportedFilters.dateTravel||"sale"===t.value&&!a.supportedFilters.dateSale||"both"===t.value&&(!a.supportedFilters.dateTravel||!a.supportedFilters.dateSale)),e.xp6(1),e.hij(" ",t.label," ")}}function ue(r,s){1&r&&(e.TgZ(0,"mat-hint"),e._uU(1,"Este relatorio nao usa data de viagem."),e.qZA())}function me(r,s){if(1&r&&(e.TgZ(0,"div",9)(1,"mat-form-field",10)(2,"mat-label"),e._uU(3,"Viagem - data inicial"),e.qZA(),e._UZ(4,"input",34)(5,"mat-datepicker-toggle",35)(6,"mat-datepicker",null,36),e.qZA(),e.TgZ(8,"mat-form-field",10)(9,"mat-label"),e._uU(10,"Viagem - data final"),e.qZA(),e._UZ(11,"input",37)(12,"mat-datepicker-toggle",35)(13,"mat-datepicker",null,38),e.qZA()()),2&r){const t=e.MAs(7),a=e.MAs(14);e.xp6(4),e.Q6J("matDatepicker",t),e.xp6(1),e.Q6J("for",t),e.xp6(6),e.Q6J("matDatepicker",a),e.xp6(1),e.Q6J("for",a)}}function fe(r,s){if(1&r&&(e.TgZ(0,"div",9)(1,"mat-form-field",10)(2,"mat-label"),e._uU(3,"Lancamento - data inicial"),e.qZA(),e._UZ(4,"input",39)(5,"mat-datepicker-toggle",35)(6,"mat-datepicker",null,40),e.qZA(),e.TgZ(8,"mat-form-field",10)(9,"mat-label"),e._uU(10,"Lancamento - data final"),e.qZA(),e._UZ(11,"input",41)(12,"mat-datepicker-toggle",35)(13,"mat-datepicker",null,42),e.qZA()()),2&r){const t=e.MAs(7),a=e.MAs(14);e.xp6(4),e.Q6J("matDatepicker",t),e.xp6(1),e.Q6J("for",t),e.xp6(6),e.Q6J("matDatepicker",a),e.xp6(1),e.Q6J("for",a)}}function ge(r,s){if(1&r&&(e.TgZ(0,"div",29)(1,"div",30),e._uU(2,"Periodo"),e.qZA(),e.TgZ(3,"div",9)(4,"mat-form-field",10)(5,"mat-label"),e._uU(6,"Filtrar por"),e.qZA(),e.TgZ(7,"mat-select",31),e.YNc(8,pe,2,3,"mat-option",32),e.qZA(),e.YNc(9,ue,2,0,"mat-hint",13),e.qZA()(),e.YNc(10,me,15,4,"div",16),e.YNc(11,fe,15,4,"div",16),e.qZA()),2&r){const t=e.oxw();e.xp6(8),e.Q6J("ngForOf",t.dateModeOptions),e.xp6(1),e.Q6J("ngIf",!t.supportedFilters.dateTravel),e.xp6(1),e.Q6J("ngIf",t.showTravelDates),e.xp6(1),e.Q6J("ngIf",t.showSaleDates)}}function he(r,s){if(1&r){const t=e.EpF();e.TgZ(0,"button",48),e.NdJ("click",function(){e.CHM(t);const o=e.oxw(3);return e.KtG(o.clearCustomer())}),e.TgZ(1,"mat-icon"),e._uU(2,"close"),e.qZA()()}}function _e(r,s){1&r&&(e.TgZ(0,"mat-option",49),e._uU(1," Nenhum cliente encontrado "),e.qZA())}function ve(r,s){if(1&r&&(e.TgZ(0,"mat-option",27)(1,"div",50)(2,"div",51),e._uU(3),e.qZA(),e.TgZ(4,"div",52),e._uU(5),e.qZA()()()),2&r){const t=s.$implicit,a=e.oxw(3);e.Q6J("value",t),e.xp6(3),e.Oqu(t.label||a.displayCustomerName(t)),e.xp6(2),e.hij(" CPF/CNPJ: ",(null==t?null:t.sublabel)||"\u2014"," ")}}function Ce(r,s){if(1&r){const t=e.EpF();e.TgZ(0,"mat-form-field",10)(1,"mat-label"),e._uU(2,"Cliente (Empresa)"),e.qZA(),e._UZ(3,"input",43),e.YNc(4,he,3,0,"button",44),e.TgZ(5,"mat-hint"),e._uU(6,"Busque por nome ou CPF/CNPJ"),e.qZA(),e.TgZ(7,"mat-autocomplete",45,46),e.NdJ("optionSelected",function(o){e.CHM(t);const n=e.oxw(2);return e.KtG(n.onCustomerSelected(o))}),e.TgZ(9,"mat-option",27),e._uU(10,"Todos"),e.qZA(),e.YNc(11,_e,2,0,"mat-option",47),e.YNc(12,ve,6,3,"mat-option",12),e.ALo(13,"async"),e.qZA()()}if(2&r){const t=e.MAs(8),a=e.oxw(2);e.xp6(3),e.Q6J("formControl",a.customerSearchInputControl)("matAutocomplete",t),e.xp6(1),e.Q6J("ngIf",a.customerSearchInputControl.value),e.xp6(3),e.Q6J("displayWith",a.displayCustomerName),e.xp6(2),e.Q6J("value",null),e.xp6(2),e.Q6J("ngIf",a.customerNotFound),e.xp6(1),e.Q6J("ngForOf",e.lcZ(13,7,a.customerOptions$))}}function be(r,s){if(1&r&&(e.TgZ(0,"mat-option",27),e._uU(1),e.qZA()),2&r){const t=s.$implicit;e.Q6J("value",t.value),e.xp6(1),e.hij(" ",t.label," ")}}function ye(r,s){if(1&r&&(e.TgZ(0,"mat-form-field",10)(1,"mat-label"),e._uU(2,"Produto/Tipo de servico"),e.qZA(),e.TgZ(3,"mat-select",53)(4,"mat-option",54),e._uU(5,"Todos"),e.qZA(),e.YNc(6,be,2,2,"mat-option",12),e.qZA()()),2&r){const t=e.oxw(2);e.xp6(6),e.Q6J("ngForOf",t.productTypeOptions)}}function xe(r,s){if(1&r){const t=e.EpF();e.TgZ(0,"button",57),e.NdJ("click",function(){e.CHM(t);const o=e.oxw(3);return e.KtG(o.clearSeller())}),e.TgZ(1,"mat-icon"),e._uU(2,"close"),e.qZA()()}}function Te(r,s){1&r&&(e.TgZ(0,"mat-option",49),e._uU(1," Nenhum vendedor encontrado "),e.qZA())}function Me(r,s){if(1&r&&(e.TgZ(0,"mat-option",27)(1,"div",58)(2,"div",59),e._uU(3),e.qZA(),e.TgZ(4,"div",60),e._uU(5),e.qZA()()()),2&r){const t=s.$implicit,a=e.oxw(3);e.Q6J("value",t),e.xp6(3),e.Oqu(a.getSellerName(t)||a.displaySellerName(t)),e.xp6(2),e.Oqu(a.getSellerEmail(t)||"\u2014")}}function Se(r,s){if(1&r){const t=e.EpF();e.TgZ(0,"mat-form-field",10)(1,"mat-label"),e._uU(2,"Vendedor"),e.qZA(),e._UZ(3,"input",43),e.YNc(4,xe,3,0,"button",55),e.TgZ(5,"mat-hint"),e._uU(6,"Busque por nome ou email"),e.qZA(),e.TgZ(7,"mat-autocomplete",45,56),e.NdJ("optionSelected",function(o){e.CHM(t);const n=e.oxw(2);return e.KtG(n.onSellerSelected(o))}),e.TgZ(9,"mat-option",27),e._uU(10,"Todos"),e.qZA(),e.YNc(11,Te,2,0,"mat-option",47),e.YNc(12,Me,6,3,"mat-option",12),e.ALo(13,"async"),e.qZA()()}if(2&r){const t=e.MAs(8),a=e.oxw(2);e.xp6(3),e.Q6J("formControl",a.sellerSearchInputControl)("matAutocomplete",t),e.xp6(1),e.Q6J("ngIf",a.sellerSearchInputControl.value),e.xp6(3),e.Q6J("displayWith",a.displaySellerName),e.xp6(2),e.Q6J("value",null),e.xp6(2),e.Q6J("ngIf",a.sellerNotFound),e.xp6(1),e.Q6J("ngForOf",e.lcZ(13,7,a.sellerOptions$))}}function Oe(r,s){if(1&r&&(e.TgZ(0,"div",9),e.YNc(1,Ce,14,9,"mat-form-field",14),e.YNc(2,ye,7,1,"mat-form-field",14),e.YNc(3,Se,14,9,"mat-form-field",14),e.qZA()),2&r){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.supportedFilters.customer),e.xp6(1),e.Q6J("ngIf",t.supportedFilters.productType),e.xp6(1),e.Q6J("ngIf",t.supportedFilters.seller)}}function Pe(r,s){1&r&&(e.TgZ(0,"mat-form-field",10)(1,"mat-label"),e._uU(2,"Passageiro"),e.qZA(),e._UZ(3,"input",62),e.qZA())}function De(r,s){1&r&&(e.TgZ(0,"mat-form-field",10)(1,"mat-label"),e._uU(2,"OS"),e.qZA(),e._UZ(3,"input",63),e.qZA())}function Re(r,s){1&r&&(e.TgZ(0,"mat-form-field",10)(1,"mat-label"),e._uU(2,"Status"),e.qZA(),e.TgZ(3,"mat-select",64)(4,"mat-option",54),e._uU(5,"Todos"),e.qZA(),e.TgZ(6,"mat-option",65),e._uU(7,"Pendente"),e.qZA(),e.TgZ(8,"mat-option",66),e._uU(9,"Concluido"),e.qZA(),e.TgZ(10,"mat-option",67),e._uU(11,"Pago"),e.qZA(),e.TgZ(12,"mat-option",68),e._uU(13,"Recebido"),e.qZA(),e.TgZ(14,"mat-option",69),e._uU(15,"Atrasado"),e.qZA(),e.TgZ(16,"mat-option",70),e._uU(17,"Faturado"),e.qZA()()())}function Ie(r,s){if(1&r){const t=e.EpF();e.TgZ(0,"mat-expansion-panel",61),e.NdJ("expandedChange",function(o){e.CHM(t);const n=e.oxw();return e.KtG(n.advancedOpen=o)}),e.TgZ(1,"mat-expansion-panel-header")(2,"mat-panel-title"),e._uU(3,"Filtros avancados"),e.qZA(),e.TgZ(4,"mat-panel-description"),e._uU(5,"Passageiro, OS, status"),e.qZA()(),e.TgZ(6,"div",9),e.YNc(7,Pe,4,0,"mat-form-field",14),e.YNc(8,De,4,0,"mat-form-field",14),e.YNc(9,Re,18,0,"mat-form-field",14),e.qZA()()}if(2&r){const t=e.oxw();e.Q6J("expanded",t.advancedOpen),e.xp6(7),e.Q6J("ngIf",t.supportedFilters.passenger),e.xp6(1),e.Q6J("ngIf",t.supportedFilters.os),e.xp6(1),e.Q6J("ngIf",t.supportedFilters.status)}}function ke(r,s){if(1&r&&(e.TgZ(0,"div",71),e._uU(1),e.qZA()),2&r){const t=e.oxw();e.xp6(1),e.hij(" ",t.summaryLine," ")}}function Fe(r,s){if(1&r&&(e.TgZ(0,"span",72),e._uU(1),e.qZA()),2&r){const t=e.oxw();e.xp6(1),e.Oqu(t.exportStatusMessage)}}function Ze(r,s){1&r&&(e.TgZ(0,"div",73),e._UZ(1,"mat-spinner"),e.TgZ(2,"p"),e._uU(3,"Processando relatorio..."),e.qZA()())}function Ae(r,s){if(1&r&&(e.TgZ(0,"th",83),e._uU(1),e.qZA()),2&r){const t=e.oxw().$implicit,a=e.oxw(2);e.xp6(1),e.Oqu(a.getColumnLabel(t))}}function Ne(r,s){if(1&r&&(e.TgZ(0,"td",84),e._uU(1),e.qZA()),2&r){const t=s.$implicit,a=e.oxw().$implicit,o=e.oxw(2);e.xp6(1),e.Oqu(o.formatCellValue(a,t[a]))}}function we(r,s){1&r&&(e.ynx(0,80),e.YNc(1,Ae,2,1,"th",81),e.YNc(2,Ne,2,1,"td",82),e.BQk()),2&r&&e.Q6J("matColumnDef",s.$implicit)}function Ee(r,s){1&r&&e._UZ(0,"tr",85)}function Ue(r,s){1&r&&e._UZ(0,"tr",86)}function qe(r,s){if(1&r&&(e.TgZ(0,"mat-card",74)(1,"mat-card-header")(2,"mat-card-title"),e._uU(3),e.qZA(),e.TgZ(4,"mat-card-subtitle"),e._uU(5),e.qZA()(),e.TgZ(6,"mat-card-content")(7,"div",75)(8,"table",76),e.YNc(9,we,3,1,"ng-container",77),e.YNc(10,Ee,1,0,"tr",78),e.YNc(11,Ue,1,0,"tr",79),e.qZA()()()()),2&r){const t=e.oxw();e.xp6(3),e.hij("Preview - ",null==t.selectedReport?null:t.selectedReport.label,""),e.xp6(2),e.AsE("",t.previewData.length," de ",t.previewTotal," registro(s)"),e.xp6(3),e.Q6J("dataSource",t.previewData),e.xp6(1),e.Q6J("ngForOf",t.displayedColumns),e.xp6(1),e.Q6J("matHeaderRowDef",t.displayedColumns),e.xp6(1),e.Q6J("matRowDefColumns",t.displayedColumns)}}const Je=[{path:"",component:(()=>{class r{constructor(t,a,o,n,i,d){this.fb=t,this.reportsService=a,this.snackBar=o,this.feedbackService=n,this.customerService=i,this.sellerService=d,this.categories=X,this.reports=ee,this.selectedCategory="performance",this.filteredReports=[],this.selectedReport=null,this.isLoading=!1,this.previewData=[],this.previewTotal=0,this.displayedColumns=[],this.currentPreviewColumns=[],this.selectedCategoryIndex=0,this.reportModeOptions=[{value:"CLIENT",label:"Relatorio para Cliente"},{value:"FINANCIAL",label:"Relatorio Geral / Financeiro"}],this.customerOptions$=(0,b.of)([]),this.sellerOptions$=(0,b.of)([]),this.customerSearchInputControl=new p.NI("",{nonNullable:!0}),this.sellerSearchInputControl=new p.NI("",{nonNullable:!0}),this.exportStatusMessage="",this.advancedOpen=!1,this.dateModeOptions=[{value:"travel",label:"Viagem (operacional)"},{value:"sale",label:"Lancamento (financeiro)"},{value:"both",label:"Ambos (avancado)"}],this.clientReportKeys=new Set(["utilization-events"]),this.utilizationClientColumns=[{key:"customerName",label:"Cliente"},{key:"passengerName",label:"Passageiro"},{key:"serviceType",label:"Produto/Servico"},{key:"origin",label:"Origem"},{key:"destination",label:"Destino"},{key:"saleDate",label:"Data da emissao"},{key:"totalValue",label:"Valor total pago"}],this.utilizationFinancialColumns=[{key:"eventDateTime",label:"Data/Hora"},{key:"customerName",label:"Cliente"},{key:"passengerName",label:"Passageiro"},{key:"productType",label:"Produto/Servico"},{key:"origin",label:"Origem"},{key:"destination",label:"Destino"},{key:"saleDate",label:"Data da venda"},{key:"costValue",label:"Custo"},{key:"marginValue",label:"Margem"},{key:"totalValue",label:"Valor total pago"}],this.ticketTypeLabels={one_way:"Ida",round_trip:"Ida e volta",multiple_routes:"Multiplos trechos",multi_city:"Multiplos trechos"},this.eventLabelLabels={ida:"Ida",volta:"Volta",retirada:"Retirada",devolucao:"Devolucao","check-in":"Check-in","check-out":"Check-out",inicio:"Inicio",retorno:"Retorno",fim:"Fim",embarque:"Embarque",viagem:"Viagem",transfer:"Transfer",trecho:"Trecho"},this.productTypeLabels=z.reduce((c,g)=>(c[g.value]=g.label,c),{}),this.statusLabels={"accounts-payable":{pending:"Pendente",completed:"Pago",paid:"Pago",delayed:"Atrasado",billed:"Faturado"},"accounts-receivable":{pending:"Pendente",completed:"Recebido",received:"Recebido",delayed:"Atrasado",billed:"Faturado"}},this.productTypeOptions=z,this.customerNotFound=!1,this.sellerNotFound=!1,this.reportForm=this.fb.group({reportKey:["",p.kI.required],reportMode:["FINANCIAL",p.kI.required],dateMode:["sale",p.kI.required],travelDateStart:[""],travelDateEnd:[""],saleDateStart:[""],saleDateEnd:[""],customerSearch:[""],customerId:[""],sellerSearch:[""],sellerId:[""],productType:[""],passengerName:[""],serviceOrderCode:[""],statusFilter:[""]})}ngOnInit(){this.selectedCategoryIndex=this.categories.findIndex(t=>t.key===this.selectedCategory),this.filteredReports=this.filterReports(this.selectedCategory,this.getReportMode()),this.reportForm.get("reportMode")?.valueChanges.subscribe(t=>{const a=t||"FINANCIAL";if("CLIENT"===a){const n=this.categories.findIndex(i=>"utilization"===i.key);n>=0&&(this.selectedCategory="utilization",this.selectedCategoryIndex=n)}this.filteredReports=this.filterReports(this.selectedCategory,a);const o=this.reportForm.get("reportKey")?.value;o&&!this.filteredReports.some(n=>n.key===o)&&(this.selectedReport=null,this.reportForm.patchValue({reportKey:""},{emitEvent:!1})),this.resetPreview()}),this.reportForm.get("reportKey")?.valueChanges.subscribe(t=>{this.selectedReport=this.reports.find(a=>a.key===t)||null,this.applyReportDefaultsAndCleanup(),this.resetPreview()}),this.reportForm.get("dateMode")?.valueChanges.subscribe(()=>{this.applyDateModeCleanup()}),this.setupCustomerAutocomplete(),this.setupSellerAutocomplete()}onCategoryChange(t){const a=this.getReportMode(),o=this.categories[t]?.key||"performance";if("CLIENT"===a){const n=this.categories.findIndex(i=>"utilization"===i.key);this.selectedCategory="utilization",this.selectedCategoryIndex=n>=0?n:t}else this.selectedCategory=o,this.selectedCategoryIndex=t;this.filteredReports=this.filterReports(this.selectedCategory,a),this.selectedReport=null,this.reportForm.patchValue({reportKey:"",productType:"",sellerId:"",sellerSearch:"",passengerName:"",serviceOrderCode:"",statusFilter:""},{emitEvent:!1}),this.advancedOpen=!1,this.resetPreview()}filterReports(t,a){let o=this.reports.filter(n=>n.category===t);return"CLIENT"===a&&(o=o.filter(n=>this.clientReportKeys.has(n.key))),o}setupCustomerAutocomplete(){const t=this.customerSearchInputControl;this.customerOptions$=t.valueChanges.pipe((0,S.O)(t.value??""),(0,_.U)(o=>String(o??"").trim()),(0,L.b)(300),(0,V.x)(),(0,Q.w)(o=>{const n=this.reportForm.get("customerSearch")?.value,i=this.reportForm.get("customerId")?.value,d=n?this.displayCustomerName(n):"";if((!i||o!==d)&&this.reportForm.patchValue({customerId:"",customerSearch:""},{emitEvent:!1}),!(o=>{const n=(o||"").trim();if(!n)return!1;const i=(0,m.A)(n);return/^\d/.test(n)?i.length>=3:n.length>=3})(o))return this.customerNotFound=!1,(0,b.of)([]);const c=(0,m.A)(o);return(/^\d/.test(o)&&c.length>=3?this.customerService.search({cpf:c,per_page:20}):this.customerService.search({name:o,per_page:20})).pipe((0,_.U)(C=>(0,m.P4)(C?.items)),(0,Y.K)(()=>(0,b.of)([])),(0,S.O)([]))}),(0,_.U)(o=>{const n=Array.isArray(o)?o:[];return this.customerNotFound=(t.value||"").toString().trim().length>0&&0===n.length,n})),t.valueChanges.subscribe(()=>{const o=this.reportForm.get("customerSearch")?.value,n=this.reportForm.get("customerId")?.value,i=o?this.displayCustomerName(o):"";(!n||t.value!==i)&&this.reportForm.patchValue({customerId:"",customerSearch:""},{emitEvent:!1})})}setupSellerAutocomplete(){const t=this.sellerSearchInputControl;this.sellerOptions$=t.valueChanges.pipe((0,S.O)(t.value??""),(0,_.U)(o=>String(o??"").trim()),(0,L.b)(300),(0,V.x)(),(0,Q.w)(o=>{const n=this.reportForm.get("sellerSearch")?.value,i=this.reportForm.get("sellerId")?.value,d=n?this.displaySellerName(n):"";return(!i||o!==d)&&this.reportForm.patchValue({sellerId:"",sellerSearch:""},{emitEvent:!1}),(o=>(o||"").trim().length>=2)(o)?this.sellerService.search({name:o,email:o,per_page:20}).pipe((0,_.U)(c=>(0,m.P4)(c?.items)),(0,Y.K)(()=>(0,b.of)([])),(0,S.O)([])):(this.sellerNotFound=!1,(0,b.of)([]))}),(0,_.U)(o=>{const n=Array.isArray(o)?o:[];return this.sellerNotFound=(t.value||"").toString().trim().length>0&&0===n.length,n})),t.valueChanges.subscribe(()=>{const o=this.reportForm.get("sellerSearch")?.value,n=this.reportForm.get("sellerId")?.value,i=o?this.displaySellerName(o):"";(!n||t.value!==i)&&this.reportForm.patchValue({sellerId:"",sellerSearch:""},{emitEvent:!1})})}onCustomerSelected(t){const a=t.option.value;if(null===a)return this.reportForm.patchValue({customerId:"",customerSearch:""},{emitEvent:!1}),void this.customerSearchInputControl.setValue("",{emitEvent:!1});const o=(0,m.aq)(a?.meta);this.reportForm.patchValue({customerId:o||"",customerSearch:a},{emitEvent:!1}),this.customerSearchInputControl.setValue("",{emitEvent:!1}),this.sellerSearchInputControl.setValue("",{emitEvent:!1}),this.customerSearchInputControl.setValue((0,m.XO)(a),{emitEvent:!1}),this.customerNotFound=!1}onSellerSelected(t){const a=t.option.value;if(null===a)return this.reportForm.patchValue({sellerId:"",sellerSearch:""},{emitEvent:!1}),void this.sellerSearchInputControl.setValue("",{emitEvent:!1});const o=(0,m.aq)(a?.meta);this.reportForm.patchValue({sellerId:o||"",sellerSearch:a},{emitEvent:!1}),this.sellerSearchInputControl.setValue((0,m.XO)(a),{emitEvent:!1}),this.sellerNotFound=!1}clearCustomer(){this.reportForm.patchValue({customerSearch:"",customerId:""},{emitEvent:!1}),this.customerSearchInputControl.setValue("",{emitEvent:!1}),this.customerNotFound=!1}clearSeller(){this.reportForm.patchValue({sellerSearch:"",sellerId:""},{emitEvent:!1}),this.sellerSearchInputControl.setValue("",{emitEvent:!1}),this.sellerNotFound=!1}displayCustomerName(t){return null===t?"Todos":t?"string"==typeof t?t:(0,m.XO)(t):""}displaySellerName(t){return null===t?"Todos":t?"string"==typeof t?t:(0,m.XO)(t):""}getSellerEmail(t){return t&&(0,m.kc)(t)?.email||""}getSellerName(t){if(!t)return"";const a=(0,m.kc)(t);return[a?.first_name,a?.surname].filter(Boolean).join(" ")||a?.first_name||""}buildCustomerLabel(t){return this.displayCustomerName(t)}resetPreview(){this.previewData=[],this.previewTotal=0,this.displayedColumns=[],this.currentPreviewColumns=[],this.exportStatusMessage=""}get supportsReportMode(){return R(this.selectedReport)}get supportedFilters(){return D(this.selectedReport)}get dateMode(){return this.reportForm.get("dateMode")?.value||"sale"}get showTravelDates(){return"travel"===this.dateMode||"both"===this.dateMode}get showSaleDates(){return"sale"===this.dateMode||"both"===this.dateMode}applyReportDefaultsAndCleanup(){const t=this.selectedReport;if(!t)return void(this.advancedOpen=!1);const a=function W(r){return r?.defaultDateMode??"sale"}(t),o=R(t)?this.getReportMode():"FINANCIAL";this.reportForm.patchValue({reportMode:o,dateMode:a},{emitEvent:!1}),this.advancedOpen=Boolean(t.defaultAdvancedOpen),this.cleanupUnsupportedFilters(),this.applyDateModeCleanup()}cleanupUnsupportedFilters(){const t=D(this.selectedReport);t.customer||(this.reportForm.patchValue({customerSearch:"",customerId:""},{emitEvent:!1}),this.customerSearchInputControl.setValue("",{emitEvent:!1})),t.seller||(this.reportForm.patchValue({sellerSearch:"",sellerId:""},{emitEvent:!1}),this.sellerSearchInputControl.setValue("",{emitEvent:!1})),t.productType||this.reportForm.patchValue({productType:""},{emitEvent:!1}),t.passenger||this.reportForm.patchValue({passengerName:""},{emitEvent:!1}),t.os||this.reportForm.patchValue({serviceOrderCode:""},{emitEvent:!1}),t.status||this.reportForm.patchValue({statusFilter:""},{emitEvent:!1}),R(this.selectedReport)||this.reportForm.patchValue({reportMode:"FINANCIAL"},{emitEvent:!1})}applyDateModeCleanup(){const t=D(this.selectedReport),a=this.dateMode;"travel"!==a||t.dateTravel||!t.dateSale?"sale"!==a||t.dateSale||!t.dateTravel?"both"!==a||t.dateTravel&&t.dateSale?("travel"===a&&this.reportForm.patchValue({saleDateStart:"",saleDateEnd:""},{emitEvent:!1}),"sale"===a&&this.reportForm.patchValue({travelDateStart:"",travelDateEnd:""},{emitEvent:!1})):this.reportForm.patchValue({dateMode:t.dateTravel?"travel":"sale"},{emitEvent:!1}):this.reportForm.patchValue({dateMode:"travel"},{emitEvent:!1}):this.reportForm.patchValue({dateMode:"sale"},{emitEvent:!1})}validateDateRange(){const{travelDateStart:t,travelDateEnd:a,saleDateStart:o,saleDateEnd:n}=this.reportForm.value;if(this.showTravelDates){if(t&&!a||!t&&a)return this.snackBar.open("Informe data inicial e final da viagem.","Fechar",{duration:3e3}),!1;if(t&&a){const i=new Date(t);if(new Date(a)<i)return this.snackBar.open("A data final da viagem nao pode ser menor que a data inicial.","Fechar",{duration:3e3}),!1}}if(this.showSaleDates){if(o&&!n||!o&&n)return this.snackBar.open("Informe data inicial e final de lancamento.","Fechar",{duration:3e3}),!1;if(o&&n){const i=new Date(o);if(new Date(n)<i)return this.snackBar.open("A data final de lancamento nao pode ser menor que a data inicial.","Fechar",{duration:3e3}),!1}}return!0}getFilters(){const t=this.reportForm.value;return{travelDateStart:this.showTravelDates&&t.travelDateStart||void 0,travelDateEnd:this.showTravelDates&&t.travelDateEnd||void 0,saleDateStart:this.showSaleDates&&t.saleDateStart||void 0,saleDateEnd:this.showSaleDates&&t.saleDateEnd||void 0,customerId:this.supportedFilters.customer&&t.customerId||void 0,passengerName:this.supportedFilters.passenger&&t.passengerName||void 0,serviceOrderCode:this.supportedFilters.os&&t.serviceOrderCode||void 0,productType:this.supportedFilters.productType&&t.productType||void 0,reportMode:this.supportsReportMode?t.reportMode||void 0:"FINANCIAL",statusFilter:this.supportedFilters.status&&t.statusFilter||void 0,sellerId:this.supportedFilters.seller&&t.sellerId||void 0}}getReportMode(){return this.reportForm.get("reportMode")?.value||"FINANCIAL"}requiresAnyRange(t){return"utilization-events"===t||"trips"===t}requiresSaleRange(t){return"sales-by-seller"===t||"cashflow-summary"===t}getActiveRangeKind(){const{travelDateStart:t,travelDateEnd:a,saleDateStart:o,saleDateEnd:n}=this.reportForm.value,i=!!t&&!!a,d=!!o&&!!n;return i&&d?"both":i?"travel":d?"sale":"none"}ensureReportRequirements(t,a){const o=this.dateMode;if(this.requiresSaleRange(t)){if("sale"!==o&&"both"!==o)return this.snackBar.open("Este relatorio exige data de lancamento. Troque o filtro de periodo para Lancamento.","Fechar",{duration:4e3}),!1;const n=this.getActiveRangeKind();if("sale"!==n&&"both"!==n)return this.snackBar.open("visualizar"===a?"Selecione o periodo de lancamento para visualizar.":"Selecione o periodo de lancamento para exportar.","Fechar",{duration:3e3}),!1}return!this.requiresAnyRange(t)||"none"!==this.getActiveRangeKind()||(this.snackBar.open("visualizar"===a?"Selecione data da viagem ou data de lancamento para visualizar.":"Selecione data da viagem ou data de lancamento para exportar.","Fechar",{duration:3e3}),!1)}onPreview(){if(!this.selectedReport)return void this.snackBar.open("Selecione um relatorio valido","Fechar",{duration:3e3});const t=this.selectedReport.key,a=this.getReportMode();if(!this.ensureReportRequirements(t,"visualizar")||!this.validateDateRange())return;this.isLoading=!0,this.exportStatusMessage="";const o=this.getFilters();this.reportsService.getReportPreview(this.selectedReport.key,o).pipe((0,$.x)(()=>this.isLoading=!1)).subscribe({next:n=>{this.previewData=n.data||[],this.previewTotal="number"==typeof n.total?n.total:this.previewData.length;const i=this.getPreviewColumns(this.selectedReport,a);this.currentPreviewColumns=i,this.displayedColumns=i.map(d=>d.key),0===this.previewData.length&&this.snackBar.open("Nenhum dado encontrado para os filtros selecionados","Fechar",{duration:3e3})},error:n=>{this.feedbackService.showHttpError(n,{fallbackMessage:"Nao foi possivel carregar dados do relatorio."})}})}onExport(t){if(!this.selectedReport)return void this.snackBar.open("Selecione um relatorio valido","Fechar",{duration:3e3});const a=this.selectedReport.key;if(!this.ensureReportRequirements(a,"exportar"))return;const o=this.getActiveRangeKind();if(!this.requiresAnyRange(a)&&!this.requiresSaleRange(a)&&"none"===o&&this.snackBar.open("Exportacao sem periodo pode demorar.","Fechar",{duration:3e3}),!this.validateDateRange())return;const n=this.getFilters(),i="pdf"===t?this.reportsService.exportReportPdf(this.selectedReport.key,n):this.reportsService.exportReportCsv(this.selectedReport.key,n),d=(new Date).toISOString().split("T")[0],g=`${this.selectedReport.key}_${d}.${"pdf"===t?"pdf":"csv"}`;this.isLoading=!0,this.exportStatusMessage="Gerando exportacao...",i.pipe((0,$.x)(()=>this.isLoading=!1)).subscribe({next:v=>{this.reportsService.downloadFile(v,g),this.exportStatusMessage="Exportacao concluida com sucesso.",this.snackBar.open("Exportacao concluida com sucesso!","Fechar",{duration:3e3})},error:v=>{this.exportStatusMessage="Erro ao exportar.",this.feedbackService.showHttpError(v,{fallbackMessage:"Nao foi possivel exportar o relatorio."})}})}getColumnLabel(t){return(this.currentPreviewColumns.length?this.currentPreviewColumns:this.selectedReport?.previewColumns||[]).find(o=>o.key===t)?.label||t}formatCellValue(t,a){if(null==a||""===a)return"-";if("ticketType"===t){const o=String(a).toLowerCase();return this.ticketTypeLabels[o]||String(a)}if("status"===t){const o=this.selectedReport?.key||"",n=String(a).toLowerCase();return this.statusLabels[o]?.[n]||String(a)}if("productType"===t||"serviceType"===t)return u(String(a).toLowerCase());if("eventLabel"===t){const o=String(a).toLowerCase();return this.eventLabelLabels[o]||String(a)}return String(a)}get summaryLine(){const t=this.selectedReport;if(!t)return"";const a=this.reportForm.value,o=[];o.push(`Relatorio: ${t.label}`);const n=this.dateMode,i=d=>{try{if(!d)return"";const c=new Date(d);return Number.isNaN(c.getTime())?String(d):c.toISOString().slice(0,10)}catch{return String(d)}};if(o.push("travel"===n?`Periodo: Viagem ${i(a.travelDateStart)} a ${i(a.travelDateEnd)}`:"sale"===n?`Periodo: Lancamento ${i(a.saleDateStart)} a ${i(a.saleDateEnd)}`:`Periodo: Viagem ${i(a.travelDateStart)} a ${i(a.travelDateEnd)} | Lancamento ${i(a.saleDateStart)} a ${i(a.saleDateEnd)}`),this.supportedFilters.customer&&a.customerId){const d="string"==typeof a.customerSearch?a.customerSearch:this.displayCustomerName(a.customerSearch);o.push(`Cliente: ${d||a.customerId}`)}if(this.supportedFilters.productType&&a.productType&&o.push(`Produto: ${u(String(a.productType).toLowerCase())}`),this.supportedFilters.seller&&a.sellerId){const d="string"==typeof a.sellerSearch?a.sellerSearch:this.displaySellerName(a.sellerSearch);o.push(`Vendedor: ${d||a.sellerId}`)}return o.join("  |  ")}get selectedCategoryDescription(){return this.categories.find(t=>t.key===this.selectedCategory)?.description||""}getPreviewColumns(t,a){return"utilization-events"===t.key?"CLIENT"===a?this.utilizationClientColumns:this.utilizationFinancialColumns:t.previewColumns}}return r.\u0275fac=function(t){return new(t||r)(e.Y36(p.qu),e.Y36(ae),e.Y36(q.ux),e.Y36(oe.T),e.Y36(re.v),e.Y36(ne.n))},r.\u0275cmp=e.Xpm({type:r,selectors:[["app-reports-dashboard"]],decls:45,vars:17,consts:[[1,"reports-dashboard"],[1,"page-header"],[1,"page-description"],[1,"category-card"],[3,"selectedIndex","selectedIndexChange"],[3,"label",4,"ngFor","ngForOf"],[1,"category-description"],[1,"filter-card"],[1,"filter-form",3,"formGroup"],[1,"filter-row"],["appearance","outline"],["formControlName","reportKey"],[3,"value",4,"ngFor","ngForOf"],[4,"ngIf"],["appearance","outline",4,"ngIf"],["class","date-group",4,"ngIf"],["class","filter-row",4,"ngIf"],["class","advanced-panel",3,"expanded","expandedChange",4,"ngIf"],["class","summary-line",4,"ngIf"],[1,"actions"],["mat-raised-button","","color","primary",3,"disabled","click"],["mat-raised-button","","color","accent",3,"disabled","click"],["mat-raised-button","","color","warn",3,"disabled","click"],["class","export-status",4,"ngIf"],["class","loading-container",4,"ngIf"],["class","preview-card",4,"ngIf"],[3,"label"],[3,"value"],["formControlName","reportMode"],[1,"date-group"],[1,"group-label"],["formControlName","dateMode"],[3,"value","disabled",4,"ngFor","ngForOf"],[3,"value","disabled"],["matInput","","formControlName","travelDateStart",3,"matDatepicker"],["matSuffix","",3,"for"],["travelStartPicker",""],["matInput","","formControlName","travelDateEnd",3,"matDatepicker"],["travelEndPicker",""],["matInput","","formControlName","saleDateStart",3,"matDatepicker"],["saleStartPicker",""],["matInput","","formControlName","saleDateEnd",3,"matDatepicker"],["saleEndPicker",""],["matInput","","type","text","autocomplete","off",3,"formControl","matAutocomplete"],["mat-icon-button","","matSuffix","","type","button","aria-label","Limpar cliente",3,"click",4,"ngIf"],[3,"displayWith","optionSelected"],["customerAutoComplete","matAutocomplete"],["disabled","",4,"ngIf"],["mat-icon-button","","matSuffix","","type","button","aria-label","Limpar cliente",3,"click"],["disabled",""],[1,"customer-option"],[1,"customer-option__name"],[1,"customer-option__doc"],["formControlName","productType"],["value",""],["mat-icon-button","","matSuffix","","type","button","aria-label","Limpar vendedor",3,"click",4,"ngIf"],["sellerAutoComplete","matAutocomplete"],["mat-icon-button","","matSuffix","","type","button","aria-label","Limpar vendedor",3,"click"],[1,"seller-option"],[1,"seller-option__name"],[1,"seller-option__email"],[1,"advanced-panel",3,"expanded","expandedChange"],["matInput","","type","text","formControlName","passengerName","autocomplete","off"],["matInput","","type","text","formControlName","serviceOrderCode","autocomplete","off"],["formControlName","statusFilter"],["value","pending"],["value","completed"],["value","paid"],["value","received"],["value","delayed"],["value","billed"],[1,"summary-line"],[1,"export-status"],[1,"loading-container"],[1,"preview-card"],[1,"table-container"],["mat-table","",1,"preview-table",3,"dataSource"],[3,"matColumnDef",4,"ngFor","ngForOf"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],[3,"matColumnDef"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["mat-header-cell",""],["mat-cell",""],["mat-header-row",""],["mat-row",""]],template:function(t,a){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"h1"),e._uU(3,"Relatorios exportaveis"),e.qZA(),e.TgZ(4,"p",2),e._uU(5,"Comece escolhendo o relatorio e o periodo. Depois refine com filtros."),e.qZA()(),e.TgZ(6,"mat-card",3)(7,"mat-tab-group",4),e.NdJ("selectedIndexChange",function(n){return a.onCategoryChange(n)}),e.YNc(8,se,1,1,"mat-tab",5),e.qZA(),e.TgZ(9,"div",6),e._uU(10),e.qZA()(),e.TgZ(11,"mat-card",7)(12,"mat-card-header")(13,"mat-card-title"),e._uU(14,"Configuracao do relatorio"),e.qZA()(),e.TgZ(15,"mat-card-content")(16,"form",8)(17,"div",9)(18,"mat-form-field",10)(19,"mat-label"),e._uU(20,"Relatorio"),e.qZA(),e.TgZ(21,"mat-select",11),e.YNc(22,ie,2,2,"mat-option",12),e.qZA(),e.YNc(23,le,2,1,"mat-hint",13),e.qZA(),e.YNc(24,ce,5,1,"mat-form-field",14),e.qZA(),e.YNc(25,ge,12,4,"div",15),e.YNc(26,Oe,4,3,"div",16),e.YNc(27,Ie,10,4,"mat-expansion-panel",17),e.YNc(28,ke,2,1,"div",18),e.qZA()(),e.TgZ(29,"mat-card-actions",19)(30,"button",20),e.NdJ("click",function(){return a.onPreview()}),e.TgZ(31,"mat-icon"),e._uU(32,"visibility"),e.qZA(),e._uU(33," Visualizar "),e.qZA(),e.TgZ(34,"button",21),e.NdJ("click",function(){return a.onExport("csv")}),e.TgZ(35,"mat-icon"),e._uU(36,"download"),e.qZA(),e._uU(37," Exportar CSV "),e.qZA(),e.TgZ(38,"button",22),e.NdJ("click",function(){return a.onExport("pdf")}),e.TgZ(39,"mat-icon"),e._uU(40,"picture_as_pdf"),e.qZA(),e._uU(41," Exportar PDF "),e.qZA(),e.YNc(42,Fe,2,1,"span",23),e.qZA()(),e.YNc(43,Ze,4,0,"div",24),e.YNc(44,qe,12,7,"mat-card",25),e.qZA()),2&t&&(e.xp6(7),e.Q6J("selectedIndex",a.selectedCategoryIndex),e.xp6(1),e.Q6J("ngForOf",a.categories),e.xp6(2),e.hij(" ",a.selectedCategoryDescription," "),e.xp6(6),e.Q6J("formGroup",a.reportForm),e.xp6(6),e.Q6J("ngForOf",a.filteredReports),e.xp6(1),e.Q6J("ngIf",a.selectedReport),e.xp6(1),e.Q6J("ngIf",a.supportsReportMode),e.xp6(1),e.Q6J("ngIf",a.selectedReport),e.xp6(1),e.Q6J("ngIf",a.selectedReport),e.xp6(1),e.Q6J("ngIf",a.selectedReport),e.xp6(1),e.Q6J("ngIf",a.selectedReport),e.xp6(2),e.Q6J("disabled",a.isLoading||!a.selectedReport),e.xp6(4),e.Q6J("disabled",a.isLoading||!a.selectedReport),e.xp6(4),e.Q6J("disabled",a.isLoading||!a.selectedReport),e.xp6(4),e.Q6J("ngIf",a.exportStatusMessage),e.xp6(1),e.Q6J("ngIf",a.isLoading),e.xp6(1),e.Q6J("ngIf",a.previewData.length>0&&!a.isLoading))},dependencies:[T.sg,T.O5,p._Y,p.Fj,p.JJ,p.JL,p.oH,p.sg,p.u,h.a8,h.dk,h.dn,h.n5,h.$j,h.hq,y.KE,y.bx,y.hX,y.R9,Z.Nt,A.gD,E.ey,N.lW,w.Hw,M.Mq,M.hl,M.nW,f.BZ,f.fO,f.as,f.w1,f.Dz,f.nj,f.ge,f.ev,f.XQ,f.Gk,U.Ou,O.SP,O.uX,P.XC,P.ZL,x.ib,x.yz,x.yK,x.u4,T.Ov],styles:[".reports-dashboard[_ngcontent-%COMP%]{padding:24px;max-width:1280px;margin:0 auto}.reports-dashboard[_ngcontent-%COMP%]   .page-header[_ngcontent-%COMP%]{margin-bottom:24px}.reports-dashboard[_ngcontent-%COMP%]   .page-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:2rem;font-weight:600;margin-bottom:8px;color:#333}.reports-dashboard[_ngcontent-%COMP%]   .page-header[_ngcontent-%COMP%]   .page-description[_ngcontent-%COMP%]{color:#666;font-size:1rem;margin:0}.reports-dashboard[_ngcontent-%COMP%]   .category-card[_ngcontent-%COMP%]{margin-bottom:16px}.reports-dashboard[_ngcontent-%COMP%]   .category-card[_ngcontent-%COMP%]   .category-description[_ngcontent-%COMP%]{padding:12px 16px 16px;color:#555;font-size:.95rem}.reports-dashboard[_ngcontent-%COMP%]   .filter-card[_ngcontent-%COMP%]{margin-bottom:24px}.reports-dashboard[_ngcontent-%COMP%]   .filter-card[_ngcontent-%COMP%]   .filter-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px}.reports-dashboard[_ngcontent-%COMP%]   .filter-card[_ngcontent-%COMP%]   .filter-form[_ngcontent-%COMP%]   .filter-row[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:16px}.reports-dashboard[_ngcontent-%COMP%]   .filter-card[_ngcontent-%COMP%]   .filter-form[_ngcontent-%COMP%]   .summary-line[_ngcontent-%COMP%]{padding:10px 12px;border:1px solid #e6e6e6;background:#fcfcfc;border-radius:8px;color:#444;font-size:.95rem;line-height:1.3}.reports-dashboard[_ngcontent-%COMP%]   .filter-card[_ngcontent-%COMP%]   .filter-form[_ngcontent-%COMP%]   .date-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px}.reports-dashboard[_ngcontent-%COMP%]   .filter-card[_ngcontent-%COMP%]   .filter-form[_ngcontent-%COMP%]   .date-group[_ngcontent-%COMP%]   .group-label[_ngcontent-%COMP%]{font-weight:600;color:#444}.reports-dashboard[_ngcontent-%COMP%]   .filter-card[_ngcontent-%COMP%]   .filter-form[_ngcontent-%COMP%]   .advanced-panel[_ngcontent-%COMP%]{background:#fafafa;margin-top:4px}.reports-dashboard[_ngcontent-%COMP%]   .filter-card[_ngcontent-%COMP%]   .filter-form[_ngcontent-%COMP%]   .advanced-panel[_ngcontent-%COMP%]   .filter-row[_ngcontent-%COMP%]{padding-top:8px}.reports-dashboard[_ngcontent-%COMP%]   .filter-card[_ngcontent-%COMP%]   .filter-form[_ngcontent-%COMP%]   .customer-option[_ngcontent-%COMP%]{display:flex;flex-direction:column;line-height:1.2;padding:2px 0}.reports-dashboard[_ngcontent-%COMP%]   .filter-card[_ngcontent-%COMP%]   .filter-form[_ngcontent-%COMP%]   .customer-option__name[_ngcontent-%COMP%]{font-weight:600;color:#333}.reports-dashboard[_ngcontent-%COMP%]   .filter-card[_ngcontent-%COMP%]   .filter-form[_ngcontent-%COMP%]   .customer-option__doc[_ngcontent-%COMP%]{font-size:.85rem;color:#666}.reports-dashboard[_ngcontent-%COMP%]   .filter-card[_ngcontent-%COMP%]   .filter-form[_ngcontent-%COMP%]   .seller-option[_ngcontent-%COMP%]{display:flex;flex-direction:column;line-height:1.2;padding:2px 0}.reports-dashboard[_ngcontent-%COMP%]   .filter-card[_ngcontent-%COMP%]   .filter-form[_ngcontent-%COMP%]   .seller-option__name[_ngcontent-%COMP%]{font-weight:600;color:#333}.reports-dashboard[_ngcontent-%COMP%]   .filter-card[_ngcontent-%COMP%]   .filter-form[_ngcontent-%COMP%]   .seller-option__email[_ngcontent-%COMP%]{font-size:.85rem;color:#666}.reports-dashboard[_ngcontent-%COMP%]   .filter-card[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:12px;align-items:center;padding:16px 24px}.reports-dashboard[_ngcontent-%COMP%]   .filter-card[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{min-width:140px}.reports-dashboard[_ngcontent-%COMP%]   .filter-card[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-right:8px}.reports-dashboard[_ngcontent-%COMP%]   .filter-card[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   .export-status[_ngcontent-%COMP%]{font-size:.95rem;color:#555;margin-left:auto}.reports-dashboard[_ngcontent-%COMP%]   .loading-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:48px;text-align:center}.reports-dashboard[_ngcontent-%COMP%]   .loading-container[_ngcontent-%COMP%]   mat-spinner[_ngcontent-%COMP%]{margin-bottom:16px}.reports-dashboard[_ngcontent-%COMP%]   .loading-container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#666;font-size:1rem}.reports-dashboard[_ngcontent-%COMP%]   .preview-card[_ngcontent-%COMP%]   .table-container[_ngcontent-%COMP%]{max-height:520px;overflow:auto;border:1px solid #e0e0e0;border-radius:4px}.reports-dashboard[_ngcontent-%COMP%]   .preview-card[_ngcontent-%COMP%]   .preview-table[_ngcontent-%COMP%]{width:100%}.reports-dashboard[_ngcontent-%COMP%]   .preview-card[_ngcontent-%COMP%]   .preview-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .reports-dashboard[_ngcontent-%COMP%]   .preview-card[_ngcontent-%COMP%]   .preview-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:12px 16px;text-align:left;border-bottom:1px solid #e0e0e0}.reports-dashboard[_ngcontent-%COMP%]   .preview-card[_ngcontent-%COMP%]   .preview-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:#f5f5f5;font-weight:600;color:#333;position:sticky;top:0;z-index:1}.reports-dashboard[_ngcontent-%COMP%]   .preview-card[_ngcontent-%COMP%]   .preview-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{color:#555}.reports-dashboard[_ngcontent-%COMP%]   .preview-card[_ngcontent-%COMP%]   .preview-table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:#f9f9f9}@media (max-width: 768px){.reports-dashboard[_ngcontent-%COMP%]{padding:16px}.reports-dashboard[_ngcontent-%COMP%]   .filter-card[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]{flex-direction:column;align-items:stretch}.reports-dashboard[_ngcontent-%COMP%]   .filter-card[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:100%}.reports-dashboard[_ngcontent-%COMP%]   .filter-card[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   .export-status[_ngcontent-%COMP%]{margin-left:0}}"]}),r})()},{path:"**",redirectTo:""}];let Le=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=e.oAB({type:r}),r.\u0275inj=e.cJS({imports:[J.Bz.forChild(Je),J.Bz]}),r})(),Ve=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=e.oAB({type:r}),r.\u0275inj=e.cJS({imports:[T.ez,p.UX,Le,h.QW,y.lN,Z.c,A.LD,N.ot,w.Ps,M.FA,E.XK,f.p0,U.Cq,q.ZX,O.Nh,P.Bb,x.To]}),r})()}}]);