"use strict";(self.webpackChunkapp_viagens=self.webpackChunkapp_viagens||[]).push([[840],{3840(He,Z,d){d.d(Z,{ReportsModule:()=>Je});var k=d(2200),m=d(9417),_=d(5596),Q=d(1228),N=d(3746),$=d(6183),w=d(8834),j=d(2629),S=d(5084),q=d(3),g=d(6192),V=d(9183),G=d(5416),P=d(6850),x=d(4518),R=d(9454),Y=d(8132),y=d(7673),D=d(9172),b=d(6354),L=d(152),A=d(3294),B=d(5558),z=d(9437),X=d(980);const ee={air_ticket:"Passagem A\xe9rea",bus_ticket:"Passagem Rodovi\xe1ria",train_ticket:"Passagem Ferrovi\xe1ria",hotel:"Hotel",car_rental:"Aluguel de Ve\xedculo",travel_insurance:"Seguro Viagem",travel_package:"Pacote de Viagem",transfer:"Transfer",seat:"Assento",extra_baggage:"Bagagem Extra",rebooking:"Remarca\xe7\xe3o"};function f(r){if(null==r)return"";const i=String(r).trim();return i?ee[i]??i:""}const te=[{key:"performance",label:"Desempenho",code:"A",description:"Indicadores e visoes de vendas para acompanhar resultados e produtividade."},{key:"utilization",label:"Utilizacao",code:"B",description:"Eventos operacionais por periodo e produto, mostrando o uso real dos servicos."},{key:"financial",label:"Financeiro",code:"C",description:"Movimentacoes financeiras e fluxo de caixa com contas a pagar/receber."}],U=[{value:"air_ticket",label:f("air_ticket")},{value:"car_rental",label:f("car_rental")},{value:"hotel",label:f("hotel")},{value:"travel_package",label:f("travel_package")},{value:"travel_insurance",label:f("travel_insurance")},{value:"rebooking",label:f("rebooking")},{value:"extra_baggage",label:f("extra_baggage")},{value:"seat",label:f("seat")},{value:"bus_ticket",label:f("bus_ticket")},{value:"train_ticket",label:f("train_ticket")},{value:"transfer",label:f("transfer")}],ae={customer:!0,seller:!1,productType:!1,passenger:!1,os:!1,status:!1,dateTravel:!1,dateSale:!0};function I(r){return{...ae,...r?.supportedFilters??{}}}function O(r){return!!r?.supportsReportMode}const re=[{key:"sales",label:"Vendas",description:"Relatorio detalhado de vendas com clientes e vendedores.",category:"performance",requiresDate:!1,supportsReportMode:!0,defaultDateMode:"sale",supportedFilters:{customer:!0,seller:!0,productType:!0,passenger:!0,os:!0,status:!1,dateTravel:!0,dateSale:!0},previewColumns:[{key:"customerName",label:"Cliente"},{key:"productType",label:"Produto/Servico"},{key:"sellDate",label:"Data da emissao"},{key:"paymentMethod",label:"Metodo de pagamento"},{key:"costValue",label:"Custo"},{key:"totalValue",label:"Valor total pago"}]},{key:"sales-by-seller",label:"Vendas por Vendedor",description:"Resumo por vendedor com volume e ticket medio.",category:"performance",requiresDate:!0,supportsReportMode:!1,defaultDateMode:"sale",supportedFilters:{customer:!0,seller:!0,productType:!1,passenger:!1,os:!1,status:!1,dateTravel:!1,dateSale:!0},previewColumns:[{key:"sellerName",label:"Vendedor"},{key:"totalSales",label:"Total vendas"},{key:"totalValue",label:"Valor total"},{key:"avgTicket",label:"Ticket medio"},{key:"totalCommission",label:"Comissao total"}]},{key:"utilization-events",label:"Utilizacao (Eventos)",description:"Eventos de uso por produto no periodo selecionado.",category:"utilization",requiresDate:!0,supportsReportMode:!0,defaultDateMode:"travel",supportedFilters:{customer:!0,seller:!1,productType:!0,passenger:!0,os:!0,status:!1,dateTravel:!0,dateSale:!0},previewColumns:[{key:"eventDateTime",label:"Data/Hora"},{key:"customerName",label:"Cliente"},{key:"passengerName",label:"Passageiro"},{key:"productType",label:"Produto/Servico"},{key:"origin",label:"Origem"},{key:"destination",label:"Destino"},{key:"saleDate",label:"Data da venda"},{key:"costValue",label:"Custo"},{key:"marginValue",label:"Margem"},{key:"totalValue",label:"Valor total pago"}]},{key:"trips",label:"Aereo (Trechos)",description:"Detalhamento de trechos aereos com datas e origens.",category:"utilization",requiresDate:!0,supportsReportMode:!1,defaultDateMode:"travel",supportedFilters:{customer:!0,seller:!1,productType:!1,passenger:!0,os:!0,status:!1,dateTravel:!0,dateSale:!0},previewColumns:[{key:"customerName",label:"Cliente"},{key:"ticketType",label:"Tipo de bilhete"},{key:"airline",label:"Companhia"},{key:"origin",label:"Aeroporto origem"},{key:"originCity",label:"Cidade origem"},{key:"departureDateTime",label:"Data/hora partida"},{key:"value",label:"Valor"},{key:"sellDate",label:"Data da venda"}]},{key:"accounts-payable",label:"Contas a Pagar",description:"Transacoes de despesas com status e datas de pagamento.",category:"financial",requiresDate:!1,supportsStatusFilter:!0,supportsReportMode:!1,defaultDateMode:"sale",supportedFilters:{customer:!0,seller:!1,productType:!1,passenger:!1,os:!1,status:!0,dateTravel:!1,dateSale:!0},previewColumns:[{key:"customerName",label:"Cliente"},{key:"amount",label:"Valor"},{key:"status",label:"Status"},{key:"paymentDate",label:"Data pagamento"}]},{key:"accounts-receivable",label:"Contas a Receber",description:"Transacoes de receitas com status e datas de recebimento.",category:"financial",requiresDate:!1,supportsStatusFilter:!0,supportsReportMode:!1,defaultDateMode:"sale",supportedFilters:{customer:!0,seller:!1,productType:!1,passenger:!1,os:!1,status:!0,dateTravel:!1,dateSale:!0},previewColumns:[{key:"customerName",label:"Cliente"},{key:"amount",label:"Valor"},{key:"status",label:"Status"},{key:"receivedDate",label:"Data recebimento"}]},{key:"cashflow-summary",label:"Fluxo de Caixa",description:"Resumo de entradas, saidas e saldo por periodo.",category:"financial",requiresDate:!0,supportsReportMode:!1,defaultDateMode:"sale",supportedFilters:{customer:!1,seller:!1,productType:!1,passenger:!1,os:!1,status:!1,dateTravel:!1,dateSale:!0},previewColumns:[{key:"period",label:"Periodo"},{key:"totalIncome",label:"Entradas"},{key:"totalExpense",label:"Saidas"},{key:"netValue",label:"Saldo"}]}];var h=d(5743),e=d(3664),p=d(2615),K=d(9330),E=d(8810),J=d(5312),ne=d(6341);let se=(()=>{var r;class i{constructor(t,o){this.http=t,this.tenantService=o,this.apiUrl=`${J.c.backendV1Url}/reports`}toYmd(t){if(!t)return;if("string"==typeof t){const c=t.match(/^(\d{4}-\d{2}-\d{2})/);if(c)return c[1]}const o="string"==typeof t?new Date(t):t;return isNaN(o.getTime())?void 0:`${o.getFullYear()}-${String(o.getMonth()+1).padStart(2,"0")}-${String(o.getDate()).padStart(2,"0")}`}buildParams(t,o){let a=new K.Nl;const s=this.toYmd(t.startDate),l=this.toYmd(t.endDate);s&&(a=a.set("start_date",s)),l&&(a=a.set("end_date",l));const c=this.toYmd(t.travelDateStart),u=this.toYmd(t.travelDateEnd);c&&(a=a.set("travel_date_start",c)),u&&(a=a.set("travel_date_end",u));const v=this.toYmd(t.saleDateStart),C=this.toYmd(t.saleDateEnd);v&&(a=a.set("sale_date_start",v)),C&&(a=a.set("sale_date_end",C)),t.statusFilter&&(a=a.set("status_filter",t.statusFilter)),null!=t.sellerId&&""!==String(t.sellerId)&&(a=a.set("seller_id",String(t.sellerId))),null!=t.customerId&&""!==String(t.customerId)&&(a=a.set("customer_id",String(t.customerId))),t.serviceOrderCode&&(a=a.set("service_order_code",String(t.serviceOrderCode))),t.passengerName&&(a=a.set("passenger_name",String(t.passengerName))),t.reportMode&&(a=a.set("report_mode",t.reportMode));const F=t.saleType,T=t.productType;return T&&(a=a.set("product_type",T)),T||("utilization-events"===o?F&&(a=a.set("product_type",F)):F&&(a=a.set("category",F))),a}exportReportCsv(t,o){const a=this.tenantService.getCurrentTenantId();if(!a)return(0,E.$)(()=>new Error("TenantId nao resolvido"));const s=this.buildParams(o,t);return this.http.get(`${this.apiUrl}/csv/${t}`,{params:s,responseType:"blob",headers:{"mtm-token":`Bearer ${localStorage.getItem("token")??""}`,"X-Tenant-Id":a}})}exportReportPdf(t,o){const a=this.tenantService.getCurrentTenantId();if(!a)return(0,E.$)(()=>new Error("TenantId nao resolvido"));const s=this.buildParams(o,t);return this.http.get(`${this.apiUrl}/pdf/${t}`,{params:s,responseType:"blob",headers:{"mtm-token":`Bearer ${localStorage.getItem("token")??""}`,"X-Tenant-Id":a}})}exportSalesReport(t){return this.exportReportCsv("sales",t)}exportTripsReport(t){return this.exportReportCsv("trips",t)}exportAccountsPayableReport(t){return this.exportReportCsv("accounts-payable",t)}exportAccountsReceivableReport(t){return this.exportReportCsv("accounts-receivable",t)}downloadFile(t,o){const a=window.URL.createObjectURL(t),s=document.createElement("a");s.href=a,s.download=o,document.body.appendChild(s),s.click(),document.body.removeChild(s),window.URL.revokeObjectURL(a)}getReportPreview(t,o){const a=this.buildParams(o,t),s=this.tenantService.getCurrentTenantId();if(!s)return(0,E.$)(()=>new Error("TenantId nao resolvido"));if(!J.c.production){const l=this.toYmd(o.startDate),c=this.toYmd(o.endDate);console.debug("[Reports] preview params",{start_date:l,end_date:c,travel_date_start:this.toYmd(o.travelDateStart),travel_date_end:this.toYmd(o.travelDateEnd),sale_date_start:this.toYmd(o.saleDateStart),sale_date_end:this.toYmd(o.saleDateEnd),seller_id:o.sellerId,category:"utilization-events"===t?void 0:o.saleType,product_type:"utilization-events"===t?o.productType||o.saleType:void 0,status_filter:o.statusFilter,customer_id:o.customerId,service_order_code:o.serviceOrderCode,passenger_name:o.passengerName,report_mode:o.reportMode,reportType:t})}return this.http.get(`${this.apiUrl}/preview/${t}`,{params:a,headers:{"mtm-token":`Bearer ${localStorage.getItem("token")??""}`,"X-Tenant-Id":s}}).pipe((0,b.T)(l=>({data:l.data??[],total:"number"==typeof l.total_count?l.total_count:l.total??(l.data?l.data.length:0)})))}static#e=r=()=>(this.\u0275fac=function(o){return new(o||i)(p.KVO(K.Qq),p.KVO(ne.I))},this.\u0275prov=p.jDH({token:i,factory:i.\u0275fac,providedIn:"root"}))}return r(),i})();var ie=d(9545),le=d(2601),de=d(430),M=d(4727),ce=d(407),pe=d(2598),H=d(9863);function ue(r,i){if(1&r&&e.nrm(0,"mat-tab",31),2&r){const n=i.$implicit;e.Y8G("label",n.code+") "+n.label)}}function me(r,i){if(1&r&&(e.j41(0,"mat-option",32),e.EFF(1),e.k0s()),2&r){const n=i.$implicit;e.Y8G("value",n.key),e.R7$(),e.SpI(" ",n.label," ")}}function fe(r,i){if(1&r&&(e.j41(0,"mat-hint"),e.EFF(1),e.k0s()),2&r){const n=e.XpG();e.R7$(),e.JRh(n.selectedReport.description)}}function he(r,i){if(1&r&&(e.j41(0,"mat-option",32),e.EFF(1),e.k0s()),2&r){const n=i.$implicit;e.Y8G("value",n.value),e.R7$(),e.SpI(" ",n.label," ")}}function ge(r,i){if(1&r&&(e.j41(0,"mat-form-field",15)(1,"mat-label"),e.EFF(2,"Tipo de relatorio"),e.k0s(),e.j41(3,"mat-select",33),e.DNE(4,he,2,2,"mat-option",17),e.k0s()()),2&r){const n=e.XpG();e.R7$(4),e.Y8G("ngForOf",n.reportModeOptions)}}function ve(r,i){if(1&r&&(e.j41(0,"mat-option",38),e.EFF(1),e.k0s()),2&r){const n=i.$implicit,t=e.XpG(2);e.Y8G("value",n.value)("disabled","travel"===n.value&&!t.supportedFilters.dateTravel||"sale"===n.value&&!t.supportedFilters.dateSale||"both"===n.value&&(!t.supportedFilters.dateTravel||!t.supportedFilters.dateSale)),e.R7$(),e.SpI(" ",n.label," ")}}function _e(r,i){1&r&&(e.j41(0,"mat-hint"),e.EFF(1,"Este relatorio nao usa data de viagem."),e.k0s())}function be(r,i){if(1&r&&(e.j41(0,"div",14)(1,"mat-form-field",15)(2,"mat-label"),e.EFF(3,"Viagem - data inicial"),e.k0s(),e.nrm(4,"input",39)(5,"mat-datepicker-toggle",40)(6,"mat-datepicker",null,0),e.k0s(),e.j41(8,"mat-form-field",15)(9,"mat-label"),e.EFF(10,"Viagem - data final"),e.k0s(),e.nrm(11,"input",41)(12,"mat-datepicker-toggle",40)(13,"mat-datepicker",null,1),e.k0s()()),2&r){const n=e.sdS(7),t=e.sdS(14);e.R7$(4),e.Y8G("matDatepicker",n),e.R7$(),e.Y8G("for",n),e.R7$(6),e.Y8G("matDatepicker",t),e.R7$(),e.Y8G("for",t)}}function Ce(r,i){if(1&r&&(e.j41(0,"div",14)(1,"mat-form-field",15)(2,"mat-label"),e.EFF(3,"Lancamento - data inicial"),e.k0s(),e.nrm(4,"input",42)(5,"mat-datepicker-toggle",40)(6,"mat-datepicker",null,2),e.k0s(),e.j41(8,"mat-form-field",15)(9,"mat-label"),e.EFF(10,"Lancamento - data final"),e.k0s(),e.nrm(11,"input",43)(12,"mat-datepicker-toggle",40)(13,"mat-datepicker",null,3),e.k0s()()),2&r){const n=e.sdS(7),t=e.sdS(14);e.R7$(4),e.Y8G("matDatepicker",n),e.R7$(),e.Y8G("for",n),e.R7$(6),e.Y8G("matDatepicker",t),e.R7$(),e.Y8G("for",t)}}function Fe(r,i){if(1&r&&(e.j41(0,"div",34)(1,"div",35),e.EFF(2,"Periodo"),e.k0s(),e.j41(3,"div",14)(4,"mat-form-field",15)(5,"mat-label"),e.EFF(6,"Filtrar por"),e.k0s(),e.j41(7,"mat-select",36),e.DNE(8,ve,2,3,"mat-option",37),e.k0s(),e.DNE(9,_e,2,0,"mat-hint",18),e.k0s()(),e.DNE(10,be,15,4,"div",21)(11,Ce,15,4,"div",21),e.k0s()),2&r){const n=e.XpG();e.R7$(8),e.Y8G("ngForOf",n.dateModeOptions),e.R7$(),e.Y8G("ngIf",!n.supportedFilters.dateTravel),e.R7$(),e.Y8G("ngIf",n.showTravelDates),e.R7$(),e.Y8G("ngIf",n.showSaleDates)}}function ye(r,i){if(1&r){const n=e.RV6();e.j41(0,"button",48),e.bIt("click",function(){p.eBV(n);const o=e.XpG(3);return p.Njj(o.clearCustomer())}),e.j41(1,"mat-icon"),e.EFF(2,"close"),e.k0s()()}}function Re(r,i){1&r&&(e.j41(0,"mat-option",49),e.EFF(1," Nenhum cliente encontrado "),e.k0s())}function ke(r,i){if(1&r&&(e.j41(0,"mat-option",32)(1,"div",50)(2,"div",51),e.EFF(3),e.k0s(),e.j41(4,"div",52),e.EFF(5),e.k0s()()()),2&r){const n=i.$implicit,t=e.XpG(3);e.Y8G("value",n),e.R7$(3),e.JRh(n.label||t.displayCustomerName(n)),e.R7$(2),e.SpI(" CPF/CNPJ: ",(null==n?null:n.sublabel)||"\u2014"," ")}}function Se(r,i){if(1&r){const n=e.RV6();e.j41(0,"mat-form-field",15)(1,"mat-label"),e.EFF(2,"Cliente (Empresa)"),e.k0s(),e.nrm(3,"input",44),e.DNE(4,ye,3,0,"button",45),e.j41(5,"mat-hint"),e.EFF(6,"Busque por nome ou CPF/CNPJ"),e.k0s(),e.j41(7,"mat-autocomplete",46,4),e.bIt("optionSelected",function(o){p.eBV(n);const a=e.XpG(2);return p.Njj(a.onCustomerSelected(o))}),e.j41(9,"mat-option",32),e.EFF(10,"Todos"),e.k0s(),e.DNE(11,Re,2,0,"mat-option",47)(12,ke,6,3,"mat-option",17),e.nI1(13,"async"),e.k0s()()}if(2&r){const n=e.sdS(8),t=e.XpG(2);e.R7$(3),e.Y8G("formControl",t.customerSearchInputControl)("matAutocomplete",n),e.R7$(),e.Y8G("ngIf",t.customerSearchInputControl.value),e.R7$(3),e.Y8G("displayWith",t.displayCustomerName),e.R7$(2),e.Y8G("value",null),e.R7$(2),e.Y8G("ngIf",t.customerNotFound),e.R7$(),e.Y8G("ngForOf",e.bMT(13,7,t.customerOptions$))}}function De(r,i){if(1&r&&(e.j41(0,"mat-option",32),e.EFF(1),e.k0s()),2&r){const n=i.$implicit;e.Y8G("value",n.value),e.R7$(),e.SpI(" ",n.label," ")}}function Me(r,i){if(1&r&&(e.j41(0,"mat-form-field",15)(1,"mat-label"),e.EFF(2,"Produto/Tipo de servico"),e.k0s(),e.j41(3,"mat-select",53)(4,"mat-option",54),e.EFF(5,"Todos"),e.k0s(),e.DNE(6,De,2,2,"mat-option",17),e.k0s()()),2&r){const n=e.XpG(2);e.R7$(6),e.Y8G("ngForOf",n.productTypeOptions)}}function Pe(r,i){if(1&r){const n=e.RV6();e.j41(0,"button",56),e.bIt("click",function(){p.eBV(n);const o=e.XpG(3);return p.Njj(o.clearSeller())}),e.j41(1,"mat-icon"),e.EFF(2,"close"),e.k0s()()}}function xe(r,i){1&r&&(e.j41(0,"mat-option",49),e.EFF(1," Nenhum vendedor encontrado "),e.k0s())}function Ie(r,i){if(1&r&&(e.j41(0,"mat-option",32)(1,"div",57)(2,"div",58),e.EFF(3),e.k0s(),e.j41(4,"div",59),e.EFF(5),e.k0s()()()),2&r){const n=i.$implicit,t=e.XpG(3);e.Y8G("value",n),e.R7$(3),e.JRh(t.getSellerName(n)||t.displaySellerName(n)),e.R7$(2),e.JRh(t.getSellerEmail(n)||"\u2014")}}function Oe(r,i){if(1&r){const n=e.RV6();e.j41(0,"mat-form-field",15)(1,"mat-label"),e.EFF(2,"Vendedor"),e.k0s(),e.nrm(3,"input",44),e.DNE(4,Pe,3,0,"button",55),e.j41(5,"mat-hint"),e.EFF(6,"Busque por nome ou email"),e.k0s(),e.j41(7,"mat-autocomplete",46,5),e.bIt("optionSelected",function(o){p.eBV(n);const a=e.XpG(2);return p.Njj(a.onSellerSelected(o))}),e.j41(9,"mat-option",32),e.EFF(10,"Todos"),e.k0s(),e.DNE(11,xe,2,0,"mat-option",47)(12,Ie,6,3,"mat-option",17),e.nI1(13,"async"),e.k0s()()}if(2&r){const n=e.sdS(8),t=e.XpG(2);e.R7$(3),e.Y8G("formControl",t.sellerSearchInputControl)("matAutocomplete",n),e.R7$(),e.Y8G("ngIf",t.sellerSearchInputControl.value),e.R7$(3),e.Y8G("displayWith",t.displaySellerName),e.R7$(2),e.Y8G("value",null),e.R7$(2),e.Y8G("ngIf",t.sellerNotFound),e.R7$(),e.Y8G("ngForOf",e.bMT(13,7,t.sellerOptions$))}}function Ee(r,i){if(1&r&&(e.j41(0,"div",14),e.DNE(1,Se,14,9,"mat-form-field",19)(2,Me,7,1,"mat-form-field",19)(3,Oe,14,9,"mat-form-field",19),e.k0s()),2&r){const n=e.XpG();e.R7$(),e.Y8G("ngIf",n.supportedFilters.customer),e.R7$(),e.Y8G("ngIf",n.supportedFilters.productType),e.R7$(),e.Y8G("ngIf",n.supportedFilters.seller)}}function Te(r,i){1&r&&(e.j41(0,"mat-form-field",15)(1,"mat-label"),e.EFF(2,"Passageiro"),e.k0s(),e.nrm(3,"input",61),e.k0s())}function Ne(r,i){1&r&&(e.j41(0,"mat-form-field",15)(1,"mat-label"),e.EFF(2,"OS"),e.k0s(),e.nrm(3,"input",62),e.k0s())}function $e(r,i){1&r&&(e.j41(0,"mat-form-field",15)(1,"mat-label"),e.EFF(2,"Status"),e.k0s(),e.j41(3,"mat-select",63)(4,"mat-option",54),e.EFF(5,"Todos"),e.k0s(),e.j41(6,"mat-option",64),e.EFF(7,"Pendente"),e.k0s(),e.j41(8,"mat-option",65),e.EFF(9,"Concluido"),e.k0s(),e.j41(10,"mat-option",66),e.EFF(11,"Pago"),e.k0s(),e.j41(12,"mat-option",67),e.EFF(13,"Recebido"),e.k0s(),e.j41(14,"mat-option",68),e.EFF(15,"Atrasado"),e.k0s(),e.j41(16,"mat-option",69),e.EFF(17,"Faturado"),e.k0s()()())}function we(r,i){if(1&r){const n=e.RV6();e.j41(0,"mat-expansion-panel",60),e.mxI("expandedChange",function(o){p.eBV(n);const a=e.XpG();return e.DH7(a.advancedOpen,o)||(a.advancedOpen=o),p.Njj(o)}),e.j41(1,"mat-expansion-panel-header")(2,"mat-panel-title"),e.EFF(3,"Filtros avancados"),e.k0s(),e.j41(4,"mat-panel-description"),e.EFF(5,"Passageiro, OS, status"),e.k0s()(),e.j41(6,"div",14),e.DNE(7,Te,4,0,"mat-form-field",19)(8,Ne,4,0,"mat-form-field",19)(9,$e,18,0,"mat-form-field",19),e.k0s()()}if(2&r){const n=e.XpG();e.R50("expanded",n.advancedOpen),e.R7$(7),e.Y8G("ngIf",n.supportedFilters.passenger),e.R7$(),e.Y8G("ngIf",n.supportedFilters.os),e.R7$(),e.Y8G("ngIf",n.supportedFilters.status)}}function je(r,i){if(1&r&&(e.j41(0,"div",70),e.EFF(1),e.k0s()),2&r){const n=e.XpG();e.R7$(),e.SpI(" ",n.summaryLine," ")}}function Ve(r,i){if(1&r&&(e.j41(0,"span",71),e.EFF(1),e.k0s()),2&r){const n=e.XpG();e.R7$(),e.JRh(n.exportStatusMessage)}}function Ge(r,i){1&r&&(e.j41(0,"div",72),e.nrm(1,"mat-spinner"),e.j41(2,"p"),e.EFF(3,"Processando relatorio..."),e.k0s()())}function Ye(r,i){if(1&r&&(e.j41(0,"th",82),e.EFF(1),e.k0s()),2&r){const n=e.XpG().$implicit,t=e.XpG(2);e.R7$(),e.JRh(t.getColumnLabel(n))}}function Le(r,i){if(1&r&&(e.j41(0,"td",83),e.EFF(1),e.k0s()),2&r){const n=i.$implicit,t=e.XpG().$implicit,o=e.XpG(2);e.R7$(),e.JRh(o.formatCellValue(t,n[t]))}}function Ae(r,i){1&r&&(e.qex(0,79),e.DNE(1,Ye,2,1,"th",80)(2,Le,2,1,"td",81),e.bVm()),2&r&&e.Y8G("matColumnDef",i.$implicit)}function Be(r,i){1&r&&e.nrm(0,"tr",84)}function ze(r,i){1&r&&e.nrm(0,"tr",85)}function Xe(r,i){if(1&r&&(e.j41(0,"mat-card",73)(1,"mat-card-header")(2,"mat-card-title"),e.EFF(3),e.k0s(),e.j41(4,"mat-card-subtitle"),e.EFF(5),e.k0s()(),e.j41(6,"mat-card-content")(7,"div",74)(8,"table",75),e.DNE(9,Ae,3,1,"ng-container",76)(10,Be,1,0,"tr",77)(11,ze,1,0,"tr",78),e.k0s()()()()),2&r){const n=e.XpG();e.R7$(3),e.SpI("Preview - ",null==n.selectedReport?null:n.selectedReport.label),e.R7$(2),e.Lme("",n.previewData.length," de ",n.previewTotal," registro(s)"),e.R7$(3),e.Y8G("dataSource",n.previewData),e.R7$(),e.Y8G("ngForOf",n.displayedColumns),e.R7$(),e.Y8G("matHeaderRowDef",n.displayedColumns),e.R7$(),e.Y8G("matRowDefColumns",n.displayedColumns)}}const Ue=[{path:"",component:(()=>{var r;class i{constructor(t,o,a,s,l,c){this.fb=t,this.reportsService=o,this.snackBar=a,this.feedbackService=s,this.customerService=l,this.sellerService=c,this.categories=te,this.reports=re,this.selectedCategory="performance",this.filteredReports=[],this.selectedReport=null,this.isLoading=!1,this.previewData=[],this.previewTotal=0,this.displayedColumns=[],this.currentPreviewColumns=[],this.selectedCategoryIndex=0,this.reportModeOptions=[{value:"CLIENT",label:"Relatorio para Cliente"},{value:"FINANCIAL",label:"Relatorio Geral / Financeiro"}],this.customerOptions$=(0,y.of)([]),this.sellerOptions$=(0,y.of)([]),this.customerSearchInputControl=new m.MJ("",{nonNullable:!0}),this.sellerSearchInputControl=new m.MJ("",{nonNullable:!0}),this.exportStatusMessage="",this.advancedOpen=!1,this.dateModeOptions=[{value:"travel",label:"Viagem (operacional)"},{value:"sale",label:"Lancamento (financeiro)"},{value:"both",label:"Ambos (avancado)"}],this.clientReportKeys=new Set(["utilization-events"]),this.utilizationClientColumns=[{key:"customerName",label:"Cliente"},{key:"passengerName",label:"Passageiro"},{key:"serviceType",label:"Produto/Servico"},{key:"origin",label:"Origem"},{key:"destination",label:"Destino"},{key:"saleDate",label:"Data da emissao"},{key:"totalValue",label:"Valor total pago"}],this.utilizationFinancialColumns=[{key:"eventDateTime",label:"Data/Hora"},{key:"customerName",label:"Cliente"},{key:"passengerName",label:"Passageiro"},{key:"productType",label:"Produto/Servico"},{key:"origin",label:"Origem"},{key:"destination",label:"Destino"},{key:"saleDate",label:"Data da venda"},{key:"costValue",label:"Custo"},{key:"marginValue",label:"Margem"},{key:"totalValue",label:"Valor total pago"}],this.ticketTypeLabels={one_way:"Ida",round_trip:"Ida e volta",multiple_routes:"Multiplos trechos",multi_city:"Multiplos trechos"},this.eventLabelLabels={ida:"Ida",volta:"Volta",retirada:"Retirada",devolucao:"Devolucao","check-in":"Check-in","check-out":"Check-out",inicio:"Inicio",retorno:"Retorno",fim:"Fim",embarque:"Embarque",viagem:"Viagem",transfer:"Transfer",trecho:"Trecho"},this.productTypeLabels=U.reduce((u,v)=>(u[v.value]=v.label,u),{}),this.statusLabels={"accounts-payable":{pending:"Pendente",completed:"Pago",paid:"Pago",delayed:"Atrasado",billed:"Faturado"},"accounts-receivable":{pending:"Pendente",completed:"Recebido",received:"Recebido",delayed:"Atrasado",billed:"Faturado"}},this.productTypeOptions=U,this.customerNotFound=!1,this.sellerNotFound=!1,this.reportForm=this.fb.group({reportKey:["",m.k0.required],reportMode:["FINANCIAL",m.k0.required],dateMode:["sale",m.k0.required],travelDateStart:[""],travelDateEnd:[""],saleDateStart:[""],saleDateEnd:[""],customerSearch:[""],customerId:[""],sellerSearch:[""],sellerId:[""],productType:[""],passengerName:[""],serviceOrderCode:[""],statusFilter:[""]})}ngOnInit(){this.selectedCategoryIndex=this.categories.findIndex(t=>t.key===this.selectedCategory),this.filteredReports=this.filterReports(this.selectedCategory,this.getReportMode()),this.reportForm.get("reportMode")?.valueChanges.subscribe(t=>{const o=t||"FINANCIAL";if("CLIENT"===o){const s=this.categories.findIndex(l=>"utilization"===l.key);s>=0&&(this.selectedCategory="utilization",this.selectedCategoryIndex=s)}this.filteredReports=this.filterReports(this.selectedCategory,o);const a=this.reportForm.get("reportKey")?.value;a&&!this.filteredReports.some(s=>s.key===a)&&(this.selectedReport=null,this.reportForm.patchValue({reportKey:""},{emitEvent:!1})),this.resetPreview()}),this.reportForm.get("reportKey")?.valueChanges.subscribe(t=>{this.selectedReport=this.reports.find(o=>o.key===t)||null,this.applyReportDefaultsAndCleanup(),this.resetPreview()}),this.reportForm.get("dateMode")?.valueChanges.subscribe(()=>{this.applyDateModeCleanup()}),this.setupCustomerAutocomplete(),this.setupSellerAutocomplete()}onCategoryChange(t){const o=this.getReportMode(),a=this.categories[t]?.key||"performance";if("CLIENT"===o){const s=this.categories.findIndex(l=>"utilization"===l.key);this.selectedCategory="utilization",this.selectedCategoryIndex=s>=0?s:t}else this.selectedCategory=a,this.selectedCategoryIndex=t;this.filteredReports=this.filterReports(this.selectedCategory,o),this.selectedReport=null,this.reportForm.patchValue({reportKey:"",productType:"",sellerId:"",sellerSearch:"",passengerName:"",serviceOrderCode:"",statusFilter:""},{emitEvent:!1}),this.advancedOpen=!1,this.resetPreview()}filterReports(t,o){let a=this.reports.filter(s=>s.category===t);return"CLIENT"===o&&(a=a.filter(s=>this.clientReportKeys.has(s.key))),a}setupCustomerAutocomplete(){const t=this.customerSearchInputControl;this.customerOptions$=t.valueChanges.pipe((0,D.Z)(t.value??""),(0,b.T)(a=>String(a??"").trim()),(0,L.B)(300),(0,A.F)(),(0,B.n)(a=>{const s=this.reportForm.get("customerSearch")?.value,l=this.reportForm.get("customerId")?.value,c=s?this.displayCustomerName(s):"";if((!l||a!==c)&&this.reportForm.patchValue({customerId:"",customerSearch:""},{emitEvent:!1}),!(a=>{const s=(a||"").trim();if(!s)return!1;const l=(0,h.YO)(s);return/^\d/.test(s)?l.length>=3:s.length>=3})(a))return this.customerNotFound=!1,(0,y.of)([]);const u=(0,h.YO)(a);return(/^\d/.test(a)&&u.length>=3?this.customerService.search({cpf:u,per_page:20}):this.customerService.search({name:a,per_page:20})).pipe((0,b.T)(F=>(0,h.tv)(F?.items)),(0,z.W)(()=>(0,y.of)([])),(0,D.Z)([]))}),(0,b.T)(a=>{const s=Array.isArray(a)?a:[];return this.customerNotFound=(t.value||"").toString().trim().length>0&&0===s.length,s})),t.valueChanges.subscribe(()=>{const a=this.reportForm.get("customerSearch")?.value,s=this.reportForm.get("customerId")?.value,l=a?this.displayCustomerName(a):"";(!s||t.value!==l)&&this.reportForm.patchValue({customerId:"",customerSearch:""},{emitEvent:!1})})}setupSellerAutocomplete(){const t=this.sellerSearchInputControl;this.sellerOptions$=t.valueChanges.pipe((0,D.Z)(t.value??""),(0,b.T)(a=>String(a??"").trim()),(0,L.B)(300),(0,A.F)(),(0,B.n)(a=>{const s=this.reportForm.get("sellerSearch")?.value,l=this.reportForm.get("sellerId")?.value,c=s?this.displaySellerName(s):"";return(!l||a!==c)&&this.reportForm.patchValue({sellerId:"",sellerSearch:""},{emitEvent:!1}),(a=>(a||"").trim().length>=2)(a)?this.sellerService.search({name:a,email:a,per_page:20}).pipe((0,b.T)(u=>(0,h.tv)(u?.items)),(0,z.W)(()=>(0,y.of)([])),(0,D.Z)([])):(this.sellerNotFound=!1,(0,y.of)([]))}),(0,b.T)(a=>{const s=Array.isArray(a)?a:[];return this.sellerNotFound=(t.value||"").toString().trim().length>0&&0===s.length,s})),t.valueChanges.subscribe(()=>{const a=this.reportForm.get("sellerSearch")?.value,s=this.reportForm.get("sellerId")?.value,l=a?this.displaySellerName(a):"";(!s||t.value!==l)&&this.reportForm.patchValue({sellerId:"",sellerSearch:""},{emitEvent:!1})})}onCustomerSelected(t){const o=t.option.value;if(null===o)return this.reportForm.patchValue({customerId:"",customerSearch:""},{emitEvent:!1}),void this.customerSearchInputControl.setValue("",{emitEvent:!1});const a=(0,h.kw)(o?.meta);this.reportForm.patchValue({customerId:a||"",customerSearch:o},{emitEvent:!1}),this.customerSearchInputControl.setValue("",{emitEvent:!1}),this.sellerSearchInputControl.setValue("",{emitEvent:!1}),this.customerSearchInputControl.setValue((0,h.IF)(o),{emitEvent:!1}),this.customerNotFound=!1}onSellerSelected(t){const o=t.option.value;if(null===o)return this.reportForm.patchValue({sellerId:"",sellerSearch:""},{emitEvent:!1}),void this.sellerSearchInputControl.setValue("",{emitEvent:!1});const a=(0,h.kw)(o?.meta);this.reportForm.patchValue({sellerId:a||"",sellerSearch:o},{emitEvent:!1}),this.sellerSearchInputControl.setValue((0,h.IF)(o),{emitEvent:!1}),this.sellerNotFound=!1}clearCustomer(){this.reportForm.patchValue({customerSearch:"",customerId:""},{emitEvent:!1}),this.customerSearchInputControl.setValue("",{emitEvent:!1}),this.customerNotFound=!1}clearSeller(){this.reportForm.patchValue({sellerSearch:"",sellerId:""},{emitEvent:!1}),this.sellerSearchInputControl.setValue("",{emitEvent:!1}),this.sellerNotFound=!1}displayCustomerName(t){return null===t?"Todos":t?"string"==typeof t?t:(0,h.IF)(t):""}displaySellerName(t){return null===t?"Todos":t?"string"==typeof t?t:(0,h.IF)(t):""}getSellerEmail(t){return t&&(0,h.S2)(t)?.email||""}getSellerName(t){if(!t)return"";const o=(0,h.S2)(t);return[o?.first_name,o?.surname].filter(Boolean).join(" ")||o?.first_name||""}buildCustomerLabel(t){return this.displayCustomerName(t)}resetPreview(){this.previewData=[],this.previewTotal=0,this.displayedColumns=[],this.currentPreviewColumns=[],this.exportStatusMessage=""}get supportsReportMode(){return O(this.selectedReport)}get supportedFilters(){return I(this.selectedReport)}get dateMode(){return this.reportForm.get("dateMode")?.value||"sale"}get showTravelDates(){return"travel"===this.dateMode||"both"===this.dateMode}get showSaleDates(){return"sale"===this.dateMode||"both"===this.dateMode}applyReportDefaultsAndCleanup(){const t=this.selectedReport;if(!t)return void(this.advancedOpen=!1);const o=function oe(r){return r?.defaultDateMode??"sale"}(t),a=O(t)?this.getReportMode():"FINANCIAL";this.reportForm.patchValue({reportMode:a,dateMode:o},{emitEvent:!1}),this.advancedOpen=!!t.defaultAdvancedOpen,this.cleanupUnsupportedFilters(),this.applyDateModeCleanup()}cleanupUnsupportedFilters(){const t=I(this.selectedReport);t.customer||(this.reportForm.patchValue({customerSearch:"",customerId:""},{emitEvent:!1}),this.customerSearchInputControl.setValue("",{emitEvent:!1})),t.seller||(this.reportForm.patchValue({sellerSearch:"",sellerId:""},{emitEvent:!1}),this.sellerSearchInputControl.setValue("",{emitEvent:!1})),t.productType||this.reportForm.patchValue({productType:""},{emitEvent:!1}),t.passenger||this.reportForm.patchValue({passengerName:""},{emitEvent:!1}),t.os||this.reportForm.patchValue({serviceOrderCode:""},{emitEvent:!1}),t.status||this.reportForm.patchValue({statusFilter:""},{emitEvent:!1}),O(this.selectedReport)||this.reportForm.patchValue({reportMode:"FINANCIAL"},{emitEvent:!1})}applyDateModeCleanup(){const t=I(this.selectedReport),o=this.dateMode;"travel"!==o||t.dateTravel||!t.dateSale?"sale"!==o||t.dateSale||!t.dateTravel?"both"!==o||t.dateTravel&&t.dateSale?("travel"===o&&this.reportForm.patchValue({saleDateStart:"",saleDateEnd:""},{emitEvent:!1}),"sale"===o&&this.reportForm.patchValue({travelDateStart:"",travelDateEnd:""},{emitEvent:!1})):this.reportForm.patchValue({dateMode:t.dateTravel?"travel":"sale"},{emitEvent:!1}):this.reportForm.patchValue({dateMode:"travel"},{emitEvent:!1}):this.reportForm.patchValue({dateMode:"sale"},{emitEvent:!1})}validateDateRange(){const{travelDateStart:t,travelDateEnd:o,saleDateStart:a,saleDateEnd:s}=this.reportForm.value;if(this.showTravelDates){if(t&&!o||!t&&o)return this.snackBar.open("Informe data inicial e final da viagem.","Fechar",{duration:3e3}),!1;if(t&&o){const l=new Date(t);if(new Date(o)<l)return this.snackBar.open("A data final da viagem nao pode ser menor que a data inicial.","Fechar",{duration:3e3}),!1}}if(this.showSaleDates){if(a&&!s||!a&&s)return this.snackBar.open("Informe data inicial e final de lancamento.","Fechar",{duration:3e3}),!1;if(a&&s){const l=new Date(a);if(new Date(s)<l)return this.snackBar.open("A data final de lancamento nao pode ser menor que a data inicial.","Fechar",{duration:3e3}),!1}}return!0}getFilters(){const t=this.reportForm.value;return{travelDateStart:this.showTravelDates&&t.travelDateStart||void 0,travelDateEnd:this.showTravelDates&&t.travelDateEnd||void 0,saleDateStart:this.showSaleDates&&t.saleDateStart||void 0,saleDateEnd:this.showSaleDates&&t.saleDateEnd||void 0,customerId:this.supportedFilters.customer&&t.customerId||void 0,passengerName:this.supportedFilters.passenger&&t.passengerName||void 0,serviceOrderCode:this.supportedFilters.os&&t.serviceOrderCode||void 0,productType:this.supportedFilters.productType&&t.productType||void 0,reportMode:this.supportsReportMode?t.reportMode||void 0:"FINANCIAL",statusFilter:this.supportedFilters.status&&t.statusFilter||void 0,sellerId:this.supportedFilters.seller&&t.sellerId||void 0}}getReportMode(){return this.reportForm.get("reportMode")?.value||"FINANCIAL"}requiresAnyRange(t){return"utilization-events"===t||"trips"===t}requiresSaleRange(t){return"sales-by-seller"===t||"cashflow-summary"===t}getActiveRangeKind(){const{travelDateStart:t,travelDateEnd:o,saleDateStart:a,saleDateEnd:s}=this.reportForm.value,l=!!t&&!!o,c=!!a&&!!s;return l&&c?"both":l?"travel":c?"sale":"none"}ensureReportRequirements(t,o){const a=this.dateMode;if(this.requiresSaleRange(t)){if("sale"!==a&&"both"!==a)return this.snackBar.open("Este relatorio exige data de lancamento. Troque o filtro de periodo para Lancamento.","Fechar",{duration:4e3}),!1;const s=this.getActiveRangeKind();if("sale"!==s&&"both"!==s)return this.snackBar.open("visualizar"===o?"Selecione o periodo de lancamento para visualizar.":"Selecione o periodo de lancamento para exportar.","Fechar",{duration:3e3}),!1}return!this.requiresAnyRange(t)||"none"!==this.getActiveRangeKind()||(this.snackBar.open("visualizar"===o?"Selecione data da viagem ou data de lancamento para visualizar.":"Selecione data da viagem ou data de lancamento para exportar.","Fechar",{duration:3e3}),!1)}onPreview(){if(!this.selectedReport)return void this.snackBar.open("Selecione um relatorio valido","Fechar",{duration:3e3});const t=this.selectedReport.key,o=this.getReportMode();if(!this.ensureReportRequirements(t,"visualizar")||!this.validateDateRange())return;this.isLoading=!0,this.exportStatusMessage="";const a=this.getFilters();this.reportsService.getReportPreview(this.selectedReport.key,a).pipe((0,X.j)(()=>this.isLoading=!1)).subscribe({next:s=>{this.previewData=s.data||[],this.previewTotal="number"==typeof s.total?s.total:this.previewData.length;const l=this.getPreviewColumns(this.selectedReport,o);this.currentPreviewColumns=l,this.displayedColumns=l.map(c=>c.key),0===this.previewData.length&&this.snackBar.open("Nenhum dado encontrado para os filtros selecionados","Fechar",{duration:3e3})},error:s=>{this.feedbackService.showHttpError(s,{fallbackMessage:"Nao foi possivel carregar dados do relatorio."})}})}onExport(t){if(!this.selectedReport)return void this.snackBar.open("Selecione um relatorio valido","Fechar",{duration:3e3});const o=this.selectedReport.key;if(!this.ensureReportRequirements(o,"exportar"))return;const a=this.getActiveRangeKind();if(!this.requiresAnyRange(o)&&!this.requiresSaleRange(o)&&"none"===a&&this.snackBar.open("Exportacao sem periodo pode demorar.","Fechar",{duration:3e3}),!this.validateDateRange())return;const s=this.getFilters(),l="pdf"===t?this.reportsService.exportReportPdf(this.selectedReport.key,s):this.reportsService.exportReportCsv(this.selectedReport.key,s),c=(new Date).toISOString().split("T")[0],v=`${this.selectedReport.key}_${c}.${"pdf"===t?"pdf":"csv"}`;this.isLoading=!0,this.exportStatusMessage="Gerando exportacao...",l.pipe((0,X.j)(()=>this.isLoading=!1)).subscribe({next:C=>{this.reportsService.downloadFile(C,v),this.exportStatusMessage="Exportacao concluida com sucesso.",this.snackBar.open("Exportacao concluida com sucesso!","Fechar",{duration:3e3})},error:C=>{this.exportStatusMessage="Erro ao exportar.",this.feedbackService.showHttpError(C,{fallbackMessage:"Nao foi possivel exportar o relatorio."})}})}getColumnLabel(t){return(this.currentPreviewColumns.length?this.currentPreviewColumns:this.selectedReport?.previewColumns||[]).find(a=>a.key===t)?.label||t}formatCellValue(t,o){if(null==o||""===o)return"-";if("ticketType"===t){const a=String(o).toLowerCase();return this.ticketTypeLabels[a]||String(o)}if("status"===t){const a=this.selectedReport?.key||"",s=String(o).toLowerCase();return this.statusLabels[a]?.[s]||String(o)}if("productType"===t||"serviceType"===t)return f(String(o).toLowerCase());if("eventLabel"===t){const a=String(o).toLowerCase();return this.eventLabelLabels[a]||String(o)}return String(o)}get summaryLine(){const t=this.selectedReport;if(!t)return"";const o=this.reportForm.value,a=[];a.push(`Relatorio: ${t.label}`);const s=this.dateMode,l=c=>{try{if(!c)return"";const u=new Date(c);return Number.isNaN(u.getTime())?String(c):u.toISOString().slice(0,10)}catch{return String(c)}};if(a.push("travel"===s?`Periodo: Viagem ${l(o.travelDateStart)} a ${l(o.travelDateEnd)}`:"sale"===s?`Periodo: Lancamento ${l(o.saleDateStart)} a ${l(o.saleDateEnd)}`:`Periodo: Viagem ${l(o.travelDateStart)} a ${l(o.travelDateEnd)} | Lancamento ${l(o.saleDateStart)} a ${l(o.saleDateEnd)}`),this.supportedFilters.customer&&o.customerId){const c="string"==typeof o.customerSearch?o.customerSearch:this.displayCustomerName(o.customerSearch);a.push(`Cliente: ${c||o.customerId}`)}if(this.supportedFilters.productType&&o.productType&&a.push(`Produto: ${f(String(o.productType).toLowerCase())}`),this.supportedFilters.seller&&o.sellerId){const c="string"==typeof o.sellerSearch?o.sellerSearch:this.displaySellerName(o.sellerSearch);a.push(`Vendedor: ${c||o.sellerId}`)}return a.join("  |  ")}get selectedCategoryDescription(){return this.categories.find(t=>t.key===this.selectedCategory)?.description||""}getPreviewColumns(t,o){return"utilization-events"===t.key?"CLIENT"===o?this.utilizationClientColumns:this.utilizationFinancialColumns:t.previewColumns}static#e=r=()=>(this.\u0275fac=function(o){return new(o||i)(e.rXU(m.ok),e.rXU(se),e.rXU(G.UG),e.rXU(ie.n),e.rXU(le.m),e.rXU(de.n))},this.\u0275cmp=e.VBU({type:i,selectors:[["app-reports-dashboard"]],standalone:!1,decls:41,vars:17,consts:[["travelStartPicker",""],["travelEndPicker",""],["saleStartPicker",""],["saleEndPicker",""],["customerAutoComplete","matAutocomplete"],["sellerAutoComplete","matAutocomplete"],["title","Relat\xf3rios export\xe1veis","subtitle","Comece escolhendo o relat\xf3rio e o per\xedodo. Depois refine com filtros."],[1,"reports-dashboard"],[1,"category-card"],[3,"selectedIndexChange","selectedIndex"],[3,"label",4,"ngFor","ngForOf"],[1,"category-description"],[1,"filter-card"],[1,"filter-form",3,"formGroup"],[1,"filter-row"],["appearance","outline"],["formControlName","reportKey"],[3,"value",4,"ngFor","ngForOf"],[4,"ngIf"],["appearance","outline",4,"ngIf"],["class","date-group",4,"ngIf"],["class","filter-row",4,"ngIf"],["class","advanced-panel",3,"expanded","expandedChange",4,"ngIf"],["class","summary-line",4,"ngIf"],[1,"actions"],["mat-raised-button","","color","primary",3,"click","disabled"],["mat-raised-button","","color","accent",3,"click","disabled"],["mat-raised-button","","color","warn",3,"click","disabled"],["class","export-status",4,"ngIf"],["class","loading-container",4,"ngIf"],["class","preview-card",4,"ngIf"],[3,"label"],[3,"value"],["formControlName","reportMode"],[1,"date-group"],[1,"group-label"],["formControlName","dateMode"],[3,"value","disabled",4,"ngFor","ngForOf"],[3,"value","disabled"],["matInput","","formControlName","travelDateStart",3,"matDatepicker"],["matSuffix","",3,"for"],["matInput","","formControlName","travelDateEnd",3,"matDatepicker"],["matInput","","formControlName","saleDateStart",3,"matDatepicker"],["matInput","","formControlName","saleDateEnd",3,"matDatepicker"],["matInput","","type","text","autocomplete","off",3,"formControl","matAutocomplete"],["mat-icon-button","","matSuffix","","type","button","aria-label","Limpar cliente",3,"click",4,"ngIf"],[3,"optionSelected","displayWith"],["disabled","",4,"ngIf"],["mat-icon-button","","matSuffix","","type","button","aria-label","Limpar cliente",3,"click"],["disabled",""],[1,"customer-option"],[1,"customer-option__name"],[1,"customer-option__doc"],["formControlName","productType"],["value",""],["mat-icon-button","","matSuffix","","type","button","aria-label","Limpar vendedor",3,"click",4,"ngIf"],["mat-icon-button","","matSuffix","","type","button","aria-label","Limpar vendedor",3,"click"],[1,"seller-option"],[1,"seller-option__name"],[1,"seller-option__email"],[1,"advanced-panel",3,"expandedChange","expanded"],["matInput","","type","text","formControlName","passengerName","autocomplete","off"],["matInput","","type","text","formControlName","serviceOrderCode","autocomplete","off"],["formControlName","statusFilter"],["value","pending"],["value","completed"],["value","paid"],["value","received"],["value","delayed"],["value","billed"],[1,"summary-line"],[1,"export-status"],[1,"loading-container"],[1,"preview-card"],[1,"table-container"],["mat-table","",1,"preview-table",3,"dataSource"],[3,"matColumnDef",4,"ngFor","ngForOf"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],[3,"matColumnDef"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["mat-header-cell",""],["mat-cell",""],["mat-header-row",""],["mat-row",""]],template:function(o,a){1&o&&(e.nrm(0,"app-header-page",6),e.j41(1,"div",7)(2,"mat-card",8)(3,"mat-tab-group",9),e.bIt("selectedIndexChange",function(l){return a.onCategoryChange(l)}),e.DNE(4,ue,1,1,"mat-tab",10),e.k0s(),e.j41(5,"div",11),e.EFF(6),e.k0s()(),e.j41(7,"mat-card",12)(8,"mat-card-header")(9,"mat-card-title"),e.EFF(10,"Configuracao do relatorio"),e.k0s()(),e.j41(11,"mat-card-content")(12,"form",13)(13,"div",14)(14,"mat-form-field",15)(15,"mat-label"),e.EFF(16,"Relatorio"),e.k0s(),e.j41(17,"mat-select",16),e.DNE(18,me,2,2,"mat-option",17),e.k0s(),e.DNE(19,fe,2,1,"mat-hint",18),e.k0s(),e.DNE(20,ge,5,1,"mat-form-field",19),e.k0s(),e.DNE(21,Fe,12,4,"div",20)(22,Ee,4,3,"div",21)(23,we,10,4,"mat-expansion-panel",22)(24,je,2,1,"div",23),e.k0s()(),e.j41(25,"mat-card-actions",24)(26,"button",25),e.bIt("click",function(){return a.onPreview()}),e.j41(27,"mat-icon"),e.EFF(28,"visibility"),e.k0s(),e.EFF(29," Visualizar "),e.k0s(),e.j41(30,"button",26),e.bIt("click",function(){return a.onExport("csv")}),e.j41(31,"mat-icon"),e.EFF(32,"download"),e.k0s(),e.EFF(33," Exportar CSV "),e.k0s(),e.j41(34,"button",27),e.bIt("click",function(){return a.onExport("pdf")}),e.j41(35,"mat-icon"),e.EFF(36,"picture_as_pdf"),e.k0s(),e.EFF(37," Exportar PDF "),e.k0s(),e.DNE(38,Ve,2,1,"span",28),e.k0s()(),e.DNE(39,Ge,4,0,"div",29)(40,Xe,12,7,"mat-card",30),e.k0s()),2&o&&(e.R7$(3),e.Y8G("selectedIndex",a.selectedCategoryIndex),e.R7$(),e.Y8G("ngForOf",a.categories),e.R7$(2),e.SpI(" ",a.selectedCategoryDescription," "),e.R7$(6),e.Y8G("formGroup",a.reportForm),e.R7$(6),e.Y8G("ngForOf",a.filteredReports),e.R7$(),e.Y8G("ngIf",a.selectedReport),e.R7$(),e.Y8G("ngIf",a.supportsReportMode),e.R7$(),e.Y8G("ngIf",a.selectedReport),e.R7$(),e.Y8G("ngIf",a.selectedReport),e.R7$(),e.Y8G("ngIf",a.selectedReport),e.R7$(),e.Y8G("ngIf",a.selectedReport),e.R7$(2),e.Y8G("disabled",a.isLoading||!a.selectedReport),e.R7$(4),e.Y8G("disabled",a.isLoading||!a.selectedReport),e.R7$(4),e.Y8G("disabled",a.isLoading||!a.selectedReport),e.R7$(4),e.Y8G("ngIf",a.exportStatusMessage),e.R7$(),e.Y8G("ngIf",a.isLoading),e.R7$(),e.Y8G("ngIf",a.previewData.length>0&&!a.isLoading))},dependencies:[k.Sq,k.bT,m.qT,m.me,m.BC,m.cb,m.l_,m.j4,m.JD,_.RN,_.YY,_.m2,_.MM,_.Lc,_.dh,M.rl,M.nJ,M.MV,M.yw,N.fg,$.VO,ce.wT,w.$z,pe.iY,j.An,S.Vh,S.bZ,S.bU,g.Zl,g.tL,g.ji,g.cC,g.YV,g.iL,g.KS,g.$R,g.YZ,g.NB,V.LG,P.mq,P.T8,x.$3,x.pN,R.GK,R.Z2,R.WN,R.Q6,H.w,k.Jj],styles:[".reports-dashboard[_ngcontent-%COMP%]{padding:8px 32px 32px;max-width:1380px;margin:0 auto;display:flex;flex-direction:column;gap:16px}.reports-dashboard[_ngcontent-%COMP%]   .category-card[_ngcontent-%COMP%]{margin-bottom:0;border-radius:12px;box-shadow:0 10px 30px #0000000f}.reports-dashboard[_ngcontent-%COMP%]   .category-card[_ngcontent-%COMP%]   .category-description[_ngcontent-%COMP%]{padding:12px 20px 18px;color:var(--text-secondary);font-size:.95rem}.reports-dashboard[_ngcontent-%COMP%]   .filter-card[_ngcontent-%COMP%]{margin-bottom:0;border-radius:14px;box-shadow:0 18px 40px #00000014}.reports-dashboard[_ngcontent-%COMP%]   .filter-card[_ngcontent-%COMP%]   .filter-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px}.reports-dashboard[_ngcontent-%COMP%]   .filter-card[_ngcontent-%COMP%]   .filter-form[_ngcontent-%COMP%]   .filter-row[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:20px}.reports-dashboard[_ngcontent-%COMP%]   .filter-card[_ngcontent-%COMP%]   .filter-form[_ngcontent-%COMP%]   .summary-line[_ngcontent-%COMP%]{padding:12px 14px;border:1px dashed var(--border-color);background:var(--bg-app);border-radius:10px;color:var(--text-primary);font-size:.95rem;line-height:1.4}.reports-dashboard[_ngcontent-%COMP%]   .filter-card[_ngcontent-%COMP%]   .filter-form[_ngcontent-%COMP%]   .date-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:10px}.reports-dashboard[_ngcontent-%COMP%]   .filter-card[_ngcontent-%COMP%]   .filter-form[_ngcontent-%COMP%]   .date-group[_ngcontent-%COMP%]   .group-label[_ngcontent-%COMP%]{font-weight:700;color:var(--text-heading);letter-spacing:.01em}.reports-dashboard[_ngcontent-%COMP%]   .filter-card[_ngcontent-%COMP%]   .filter-form[_ngcontent-%COMP%]   .advanced-panel[_ngcontent-%COMP%]{background:var(--bg-app);margin-top:4px;border-radius:10px}.reports-dashboard[_ngcontent-%COMP%]   .filter-card[_ngcontent-%COMP%]   .filter-form[_ngcontent-%COMP%]   .advanced-panel[_ngcontent-%COMP%]   .filter-row[_ngcontent-%COMP%]{padding:8px 4px 12px}.reports-dashboard[_ngcontent-%COMP%]   .filter-card[_ngcontent-%COMP%]   .filter-form[_ngcontent-%COMP%]   .customer-option[_ngcontent-%COMP%]{display:flex;flex-direction:column;line-height:1.2;padding:2px 0}.reports-dashboard[_ngcontent-%COMP%]   .filter-card[_ngcontent-%COMP%]   .filter-form[_ngcontent-%COMP%]   .customer-option__name[_ngcontent-%COMP%]{font-weight:600;color:var(--text-heading)}.reports-dashboard[_ngcontent-%COMP%]   .filter-card[_ngcontent-%COMP%]   .filter-form[_ngcontent-%COMP%]   .customer-option__doc[_ngcontent-%COMP%]{font-size:.85rem;color:var(--text-muted)}.reports-dashboard[_ngcontent-%COMP%]   .filter-card[_ngcontent-%COMP%]   .filter-form[_ngcontent-%COMP%]   .seller-option[_ngcontent-%COMP%]{display:flex;flex-direction:column;line-height:1.2;padding:2px 0}.reports-dashboard[_ngcontent-%COMP%]   .filter-card[_ngcontent-%COMP%]   .filter-form[_ngcontent-%COMP%]   .seller-option__name[_ngcontent-%COMP%]{font-weight:600;color:var(--text-heading)}.reports-dashboard[_ngcontent-%COMP%]   .filter-card[_ngcontent-%COMP%]   .filter-form[_ngcontent-%COMP%]   .seller-option__email[_ngcontent-%COMP%]{font-size:.85rem;color:var(--text-muted)}.reports-dashboard[_ngcontent-%COMP%]   .filter-card[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:12px;align-items:center;justify-content:flex-end;padding:16px 24px;background:var(--bg-app);border-top:1px solid var(--border-color)}.reports-dashboard[_ngcontent-%COMP%]   .filter-card[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{min-width:150px}.reports-dashboard[_ngcontent-%COMP%]   .filter-card[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-right:8px}.reports-dashboard[_ngcontent-%COMP%]   .filter-card[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   .export-status[_ngcontent-%COMP%]{font-size:.95rem;color:var(--text-secondary);margin-left:auto}.reports-dashboard[_ngcontent-%COMP%]   .loading-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:48px;text-align:center}.reports-dashboard[_ngcontent-%COMP%]   .loading-container[_ngcontent-%COMP%]   mat-spinner[_ngcontent-%COMP%]{margin-bottom:16px}.reports-dashboard[_ngcontent-%COMP%]   .loading-container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--text-muted);font-size:1rem}.reports-dashboard[_ngcontent-%COMP%]   .preview-card[_ngcontent-%COMP%]{margin-top:12px}.reports-dashboard[_ngcontent-%COMP%]   .preview-card[_ngcontent-%COMP%]   .table-container[_ngcontent-%COMP%]{max-height:520px;overflow:auto;border:1px solid var(--border-color);border-radius:8px;box-shadow:var(--shadow-sm)}.reports-dashboard[_ngcontent-%COMP%]   .preview-card[_ngcontent-%COMP%]   .preview-table[_ngcontent-%COMP%]{width:100%}.reports-dashboard[_ngcontent-%COMP%]   .preview-card[_ngcontent-%COMP%]   .preview-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .reports-dashboard[_ngcontent-%COMP%]   .preview-card[_ngcontent-%COMP%]   .preview-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:12px 16px;text-align:left;border-bottom:1px solid var(--border-color)}.reports-dashboard[_ngcontent-%COMP%]   .preview-card[_ngcontent-%COMP%]   .preview-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:var(--bg-app);font-weight:600;color:var(--text-heading);position:sticky;top:0;z-index:1}.reports-dashboard[_ngcontent-%COMP%]   .preview-card[_ngcontent-%COMP%]   .preview-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{color:var(--text-secondary)}.reports-dashboard[_ngcontent-%COMP%]   .preview-card[_ngcontent-%COMP%]   .preview-table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:var(--bg-hover)}.reports-dashboard[_ngcontent-%COMP%]   .preview-card[_ngcontent-%COMP%]   .preview-table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(2n){background-color:var(--bg-app)}@media (max-width: 768px){.reports-dashboard[_ngcontent-%COMP%]{padding:16px}.reports-dashboard[_ngcontent-%COMP%]   .filter-card[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]{flex-direction:column;align-items:stretch}.reports-dashboard[_ngcontent-%COMP%]   .filter-card[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:100%}.reports-dashboard[_ngcontent-%COMP%]   .filter-card[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   .export-status[_ngcontent-%COMP%]{margin-left:0}}"]}))}return r(),i})()},{path:"**",redirectTo:""}];let Ke=(()=>{var r;class i{static#e=r=()=>(this.\u0275fac=function(o){return new(o||i)},this.\u0275mod=e.$C({type:i}),this.\u0275inj=p.G2t({imports:[Y.iI.forChild(Ue),Y.iI]}))}return r(),i})(),Je=(()=>{var r;class i{static#e=r=()=>(this.\u0275fac=function(o){return new(o||i)},this.\u0275mod=e.$C({type:i}),this.\u0275inj=p.G2t({imports:[k.MD,m.X1,Ke,_.Hu,Q.R,N.fS,$.Ve,w.Hl,j.m_,S.X6,q.WX,g.tP,V.D6,G._T,P.RI,x.jL,R.MY,H.w]}))}return r(),i})()}}]);